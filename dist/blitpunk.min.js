!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.blitpunk=e()}(this,function(){"use strict";function t(e){function r(){return++c.lastCallbackId}function o(t,e){return t.prio!==e.prio?e.prio-t.prio:t.id-e.id}function s(t){if(t)return-1===c.boundObjects.indexOf(t)&&c.boundObjects.push(t),t}function l(e,r,n){var a,i,o,s;for(i in n)n.hasOwnProperty(i)&&"function"==typeof(o=r[i])&&(a=n[i],Array.isArray(a)?(s=a[0],a=a[1]):s=t.PRIO_DEFAULT,e.on(a,s,o));return e}function u(e,r,n){function a(){var t,r,a;if(f)for(t=0;t<f;t++)"function"==typeof(a=(r=c.boundObjects[t])[e])?n(a,r):r[W]&&n(null,r)}if(!(h.silenced||h.off.indexOf(e)>=0)){var i,o,s,l=c.callbacks[e],u=c.callbacks[Z],f=c.boundObjects.length,d=!1;if(l||u.length)for(o=(l=l?l.concat(u):u).length,i=0;i<o;i++)s=l[i],!d&&s&&s.prio<t.PRIO_DEFAULT&&(a(),d=!0),r(s);d||a()}}if(e[W])return e;var c={lastCallbackId:0,callbacks:{},boundObjects:[]};c.callbacks[Z]=[];var h=a({},{silenced:!1,off:[]});return i(e,W,h),void 0===t.PRIO_DEFAULT&&a(t,{PRIO_MAX:Number.POSITIVE_INFINITY,PRIO_A:1e9,PRIO_B:1e7,PRIO_C:1e5,PRIO_DEFAULT:0,PRIO_LOW:-1e5,PRIO_MIN:Number.NEGATIVE_INFINITY}),e.on=function(e,i,s){var l=arguments.length;if(0!==l){var u;if(1===l){if("string"==typeof e)return void((u=h.off.indexOf(e))>=0&&h.off.splice(u,1));if("object"!=typeof e&&"function"!=typeof e)return void(X&&console.warn(K,".on() called with insufficient arguments!",arguments));s=e,e=Z,i=t.PRIO_DEFAULT}2===l&&(s=i,i=t.PRIO_DEFAULT);var f=c.callbacks,d=f[e]||(f[e]=[]),m=r(),p=a({},{id:m,fn:s,prio:"number"!=typeof i?t.PRIO_DEFAULT:i,isFunction:"function"==typeof s});return d.push(p),d.sort(o),m}h.silenced&&(n(h,"silenced",!1),h.off.length=0)},e.once=function(r,n,a){var i=arguments.length;if(i&&!(i>3)){1===i?(a=r,r=Z,n=t.PRIO_DEFAULT):2===i&&(a=n,n=t.PRIO_DEFAULT);var o=e.on(r,n,function(){var t=a.apply(this,arguments);return e.off(o),t});return o}X&&console.warn(K,".once() called with insufficient arguments!",arguments)},e.off=function(t){if(0!==arguments.length)if("string"!=typeof t){var e,r,a,i,o,s=c.callbacks,l="object"==typeof t;if("number"==typeof t||"function"==typeof t||l)for(o=Object.keys(s),a=0;a<o.length;a++)for(i=s[o[a]],r=0;r<i.length;r++)if(((e=i[r]).id===t||e.fn===t)&&(i.splice(r,1),!l))return;l&&(r=c.boundObjects.indexOf(t))>=0&&c.boundObjects.splice(r,1)}else-1===h.off.indexOf(t)&&h.off.push(t);else h.silenced||(n(h,"silenced",!0),h.off.length=0)},e.connect=function(t,e){var r=arguments.length;return 1===r?s(t):2===r?l(this,t,e):void(X&&console.warn(K,".connect() called with insufficient arguments!",arguments))},e.emit=function(){for(var t=new Array(arguments.length),e=0;e<t.length;++e)t[e]=arguments[e];var r,n,a,i=this;t.length>1&&"string"!=typeof t[0]&&"string"==typeof t[1]?(n=t.shift(),r=t.shift(),t[t.length-1]=n,a=t):(r=t.shift(),a=t.concat([i])),u(r,function(e){if(e.isFunction)e.fn.apply(i,t);else{var n=e.fn[r];"function"==typeof n?n.apply(e.fn,a):e.fn[W]&&e.fn.emit.apply(e.fn,[r].concat(t))}},function(t,e){t?t.apply(e,a):e.emit.apply(e,[i,r].concat(a))})},e.emitReduce=function(){function t(t){void 0!==t&&(n=t)}for(var e=new Array(arguments.length),r=0;r<e.length;++r)e[r]=arguments[r];var n,a=e.shift();0===e.length?(n={},e.push(n)):t(e[0]);var i=this,o=[a].concat(e),s=e.concat([i]);return u(a,function(r){if(r.isFunction)e[0]=n,t(r.fn.apply(i,e));else{var l=r.fn[a];"function"==typeof l?(s[0]=n,t(l.apply(r.fn,s))):r.fn[W]&&(o[1]=n,t(r.fn.emitReduce.apply(r.fn,o)))}},function(e,r){e&&(s[0]=n,t(e.apply(r,s)))}),n},e.from=function(t,e){var r=this;return new e(function(e){var n=r.on(t,function(t){e.next(t)});return function(){r.off(n)}})},e.subscribe=function(t,e,r,n){var a=this;return t.subscribe(function(t){a.emit(e,t)},r?function(t){a.emit(r,t)}:void 0,n?function(t){a.emit(n,t)}:void 0)},e}function e(e,a){var o=("string"==typeof e||"symbol"==typeof e)&&e||r(),s=t({}),l=!(!a||!a.replace),u=function(t){n(s,Q,t)},c=function(t){return function(e){t.apply(s,e)}}(s.emit);return i(s,"events",[]),n(s,"id",o),s.collect=function(){return s[Q]!==tt&&u(tt),s},s.emit=function(){var t,e=new Array(arguments.length);for(t=0;t<e.length;++t)e[t]=arguments[t];if(s[Q]===J)c(e);else{if(l){var r,n=e[0];for(t=0,r=s.events.length;t<r;t++)if(s.events[t][0]===n)return void(s.events[t]=e)}s.events.push(e)}},s.play=function(){return s[Q]!==J&&(u(J),s.events.forEach(c),s.events.length=0),s},s.toggle=function(){return s[Q]!==J?s.play():s.collect()},s.play()}function r(){var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)});return $?Symbol(t):t}function n(t,e,r){return Object.defineProperty(t,e,{value:r,configurable:!0,enumerable:!0}),t}function a(t,e){var r,a=Object.keys(e);for(r=a.length;r--;)n(t,a[r],e[a[r]]);return t}function i(t,e,r){return Object.defineProperty(t,e,{value:r,configurable:!0}),t}function o(t,e,r){if(t.descriptor=e||(r?r.descriptor:null),!t.descriptor)throw new Error("could not detect VODescriptor!");if(t.voArray=r||t.descriptor.createVOArray(),t.descriptor!==t.voArray.descriptor&&(t.descriptor.vertexCount!==t.voArray.descriptor.vertexCount||t.descriptor.vertexAttrCount!==t.voArray.descriptor.vertexAttrCount))throw new Error("Incompatible vertex object descriptors!");return t}function s(t,e,r){if(t.attrNames){let e=t.attrNames[r];if(void 0!==e)return e}return e+"_"+r}function l(t,e){return function(r){return t(this.voArray)[e+r]}}function u(t,e,r,n,a){return function(){const i=t(this.voArray);let o,s;for(o=0;o<r;++o)for(s=0;s<e;++s)i[o*n+a+s]=arguments[s]}}function c(t,e){return function(){return t(this.voArray)[e]}}function h(t,e,r,n,a){return function(){const i=t(this.voArray);let o,s;for(o=0;o<r;++o)for(s=0;s<e;++s)i[o*n+a+s]=arguments[o*e+s]}}function f(t,e,r,n){return function(a){const i=t(this.voArray);for(let t=0;t<e;++t)i[t*r+n]=a}}function d(t){return t[0].toUpperCase()+t.substr(1)}function m(t){return`return ${t};`}function p(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,h=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,f=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,d=arguments.length>13&&void 0!==arguments[13]?arguments[13]:0,m=arguments.length>14&&void 0!==arguments[14]?arguments[14]:0,p=arguments.length>15&&void 0!==arguments[15]?arguments[15]:1;const g=(arguments.length>16&&void 0!==arguments[16]?arguments[16]:It)||(t=>t+"");return`mat4(${g(t)}, ${g(e)}, ${g(r)}, ${g(n)}, ${g(a)}, ${g(i)}, ${g(o)}, ${g(s)}, ${g(l)}, ${g(u)}, ${g(c)}, ${g(h)}, ${g(f)}, ${g(d)}, ${g(m)}, ${g(p)})`}function g(t){return"number"==typeof t}function M(t){return"number"==typeof t}function b(t,e){if(M(t)&&M(e))return t-e;if(M(t))switch(t){case 0:return`-${e}`;default:return`${t} - ${e}`}else{if(!M(e))return`${t} - ${e}`;switch(e){case 0:return t;default:return`${t} - ${e}`}}}function x(t){return"number"==typeof t}function v(t,e){if(x(t)&&x(e))return t+e;if(x(t))switch(t){case 0:return e;default:return`${t} + ${e}`}else{if(!x(e))return`${t} + ${e}`;switch(e){case 0:return t;default:return`${t} + ${e}`}}}function y(t){let e=1;for(;t>e;)e<<=1;return e}function S(t,e){t.imgEl=Tt(e.width)&&Tt(e.height)?e:I(e),t.origWidth=e.width,t.origHeight=e.height}function I(t){const e=y(t.width),r=y(t.height),n=document.createElement("canvas");return n.width=e,n.height=r,n.getContext("2d").drawImage(t,0,0),n}function A(t){return t[Math.random()*t.length|0]}function D(t,e){return"string"==typeof e?e:"function"==typeof e?D(t,e(t)):Array.isArray(e)?e.map(D.bind(null,t)).join("\n"):e+""}function F(t){const e=t.glx.gl,r=t.glShader,n=t.source,a=D({glx:t.glx},n.source);if(e.shaderSource(r,a),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS)){const a=e.getShaderInfoLog(r);console.error(a),console.group("shader-info"),console.debug("shaderSource",t),console.log(n),console.groupEnd();const i=new Error("WebGlShader compile panic!");throw i.webGlShader=t,i.shaderInfoLog=a,i}}function E(t){const e=t.type,r=t.location,n=t.glx.gl;switch(e){case n.FLOAT:return t=>n.uniform1f(r,t);case n.FLOAT_VEC2:return t=>n.uniform2f(r,t[0],t[1]);case n.FLOAT_VEC3:return t=>n.uniform3f(r,t[0],t[1],t[2]);case n.FLOAT_VEC4:return t=>n.uniform4f(r,t[0],t[1],t[2],t[3]);case n.FLOAT_MAT4:return t=>n.uniformMatrix4fv(r,n.FALSE,t.mat4);case n.SAMPLER_2D:return t=>n.uniform1i(r,t)}const a=new Error(`WebGlUniform unknown uniform type:${e}`);throw a.webGlUniform=t,a}function w(t){const e=t.glx.gl,r=e.getProgramParameter(t.glProgram,e.ACTIVE_ATTRIBUTES);t.attributes={},t.attributeNames=[],t.attributeLocations=[];for(let e=0;e<r;++e){const r=new Ut(t,e);t.attributes[r.name]=r,t.attributeNames.push(r.name),t.attributeLocations.push(r.location)}Object.freeze(t.attributes)}function T(t){const e=t.glx.gl,r=e.getProgramParameter(t.glProgram,e.ACTIVE_UNIFORMS);t.uniforms={},t.uniformNames=[];for(let e=0;e<r;++e){const r=new kt(t,e);t.uniforms[r.name]=r,t.uniformNames.push(r.name)}Object.freeze(t.uniforms)}function _(t,e,r){const n=t.glx.gl,a=t.glProgram;if(n.attachShader(a,e),n.attachShader(a,r),n.linkProgram(a),!n.getProgramParameter(a,n.LINK_STATUS)){const e=new Error("WebGlProgram link panic!");throw e.webGlProgram=t,e}}function L(t){t.bind();const e=t.glx.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha);const r=t.repeatable?e.REPEAT:e.CLAMP_TO_EDGE;e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t.imgEl.width,t.imgEl.height,0,e.RGBA,e.UNSIGNED_BYTE,null)}function O(t){const e=t.gl;t.DEPTH_BITS=e.getParameter(e.DEPTH_BITS),t.MAX_TEXTURE_IMAGE_UNITS=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}function R(t,e){switch(e){case Ct.TYPE.UNIFORM:return t.uniform;case Ct.TYPE.ATTRIB:return t.attrib;case Ct.TYPE.TEXTURE_2D:return t.tex2d}}function P(t,e,r){const n=R(t,e);let a=n.get(r);return a||(a=[],n.set(r,a)),a}function C(t){const e=t.length;if(e>=2&&t.startsWith('"')&&t.endsWith('"'))return t.substr(1,t.length-2);if(e>=2&&t.startsWith("'")&&t.endsWith("'"))return t.substr(1,t.length-2);if(e>0&&t.match(/^\d+(\.\d+)?$/))return parseFloat(t);if("null"===t)return null;if("undefined"!==t)return"true"===t||"false"!==t&&t}function z(t,e){if(e.includes(":")){var r=e.split(":",2),n=Jt(r,2);let a=n[0],i=n[1];a=a.trim(),i=i.trim(),a&&i&&(t[a]=C(i))}}function N(t,e){let r;try{r=t.getContext("webgl",e)}catch(t){console.error(t)}if(!r)try{r=t.getContext("experimental-webgl",e)}catch(t){console.error(t)}if(!r)throw new Error("cannot create webgl1 context");return r}function H(t){const e=t.parentElement;if(!e||1!==e.nodeType)return;const r=e.nodeName;for(var n=arguments.length,a=Array(n>1?n-1:0),i=1;i<n;i++)a[i-1]=arguments[i];if(a.includes(r))return e;if(!He.includes(r))return e}function k(t,e,r){const n=t.parentElement;if(!n||1!==n.nodeType)return;const a=n.nodeName;if(!Ue.includes(a))return null==r&&n[e]||null!=r&&n[e],n}function V(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function U(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function j(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function q(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(Xr);var r=function(){var n=arguments,a=e?e.apply(this,n):n[0],i=r.cache;if(i.has(a))return i.get(a);var o=t.apply(this,n);return r.cache=i.set(a,o)||i,o};return r.cache=new(q.Cache||$r),r}function B(t){if("string"==typeof t)return t;if(Ye(t))return en(t,B)+"";if(ur(t))return an?an.call(t):"";var e=t+"";return"0"==e&&1/t==-rn?"-0":e}function Y(t,e,r,n,a){var i=-1,o=t.length;for(r||(r=Cn),a||(a=[]);++i<o;){var s=t[i];e>0&&r(s)?e>1?Y(s,e-1,r,n,a):Rn(a,s):n||(a[a.length]=s)}return a}var G="undefined"!=typeof Map,$="undefined"!=typeof Symbol,X="undefined"!=typeof console,W=$?(Symbol.eventize||(Symbol.eventize=Symbol("eventize")),Symbol.eventize):"@@eventize",Z="*",K="[eventize.js]";t.is=function(t){return!(!t||!t[W])},i(t,"EventizeNamespace",W),i(t,"queues",G?new Map:{}),t.queue=function(r){var n,a,i=arguments.length;return i>=1&&("object"==typeof r&&2!==i||(n=G?t.queues.get(r):t.queues[r]),2===i?a=arguments[1]:1===i&&"object"==typeof r&&(a=r)),n||(n=e(r,a),G?t.queues.set(n.id,n):t.queues[n.id]=n),n};var Q="state",J="play",tt="collect",et=t,rt="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},nt=function(t,e){return e={exports:{}},t(e,e.exports),e.exports}(function(t){!function(e){function r(t,e){if(t=t||"",e=e||{},t instanceof r)return t;if(!(this instanceof r))return new r(t,e);var a=n(t);this._originalInput=t,this._r=a.r,this._g=a.g,this._b=a.b,this._a=a.a,this._roundA=U(100*this._a)/100,this._format=e.format||a.format,this._gradientType=e.gradientType,this._r<1&&(this._r=U(this._r)),this._g<1&&(this._g=U(this._g)),this._b<1&&(this._b=U(this._b)),this._ok=a.ok,this._tc_id=V++}function n(t){var e={r:0,g:0,b:0},r=1,n=null,i=null,s=null,u=!1,c=!1;return"string"==typeof t&&(t=z(t)),"object"==typeof t&&(C(t.r)&&C(t.g)&&C(t.b)?(e=a(t.r,t.g,t.b),u=!0,c="%"===String(t.r).substr(-1)?"prgb":"rgb"):C(t.h)&&C(t.s)&&C(t.v)?(n=O(t.s),i=O(t.v),e=l(t.h,n,i),u=!0,c="hsv"):C(t.h)&&C(t.s)&&C(t.l)&&(n=O(t.s),s=O(t.l),e=o(t.h,n,s),u=!0,c="hsl"),t.hasOwnProperty("a")&&(r=t.a)),r=D(r),{ok:u,format:t.format||c,r:j(255,q(e.r,0)),g:j(255,q(e.g,0)),b:j(255,q(e.b,0)),a:r}}function a(t,e,r){return{r:255*F(t,255),g:255*F(e,255),b:255*F(r,255)}}function i(t,e,r){t=F(t,255),e=F(e,255),r=F(r,255);var n,a,i=q(t,e,r),o=j(t,e,r),s=(i+o)/2;if(i==o)n=a=0;else{var l=i-o;switch(a=s>.5?l/(2-i-o):l/(i+o),i){case t:n=(e-r)/l+(e<r?6:0);break;case e:n=(r-t)/l+2;break;case r:n=(t-e)/l+4}n/=6}return{h:n,s:a,l:s}}function o(t,e,r){function n(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+(e-t)*(2/3-r)*6:t}var a,i,o;if(t=F(t,360),e=F(e,100),r=F(r,100),0===e)a=i=o=r;else{var s=r<.5?r*(1+e):r+e-r*e,l=2*r-s;a=n(l,s,t+1/3),i=n(l,s,t),o=n(l,s,t-1/3)}return{r:255*a,g:255*i,b:255*o}}function s(t,e,r){t=F(t,255),e=F(e,255),r=F(r,255);var n,a,i=q(t,e,r),o=j(t,e,r),s=i,l=i-o;if(a=0===i?0:l/i,i==o)n=0;else{switch(i){case t:n=(e-r)/l+(e<r?6:0);break;case e:n=(r-t)/l+2;break;case r:n=(t-e)/l+4}n/=6}return{h:n,s:a,v:s}}function l(t,r,n){t=6*F(t,360),r=F(r,100),n=F(n,100);var a=e.floor(t),i=t-a,o=n*(1-r),s=n*(1-i*r),l=n*(1-(1-i)*r),u=a%6;return{r:255*[n,s,o,o,l,n][u],g:255*[l,n,n,s,o,o][u],b:255*[o,o,l,n,n,s][u]}}function u(t,e,r,n){var a=[L(U(t).toString(16)),L(U(e).toString(16)),L(U(r).toString(16))];return n&&a[0].charAt(0)==a[0].charAt(1)&&a[1].charAt(0)==a[1].charAt(1)&&a[2].charAt(0)==a[2].charAt(1)?a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0):a.join("")}function c(t,e,r,n,a){var i=[L(U(t).toString(16)),L(U(e).toString(16)),L(U(r).toString(16)),L(R(n))];return a&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)&&i[3].charAt(0)==i[3].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0)+i[3].charAt(0):i.join("")}function h(t,e,r,n){return[L(R(n)),L(U(t).toString(16)),L(U(e).toString(16)),L(U(r).toString(16))].join("")}function f(t,e){e=0===e?0:e||10;var n=r(t).toHsl();return n.s-=e/100,n.s=E(n.s),r(n)}function d(t,e){e=0===e?0:e||10;var n=r(t).toHsl();return n.s+=e/100,n.s=E(n.s),r(n)}function m(t){return r(t).desaturate(100)}function p(t,e){e=0===e?0:e||10;var n=r(t).toHsl();return n.l+=e/100,n.l=E(n.l),r(n)}function g(t,e){e=0===e?0:e||10;var n=r(t).toRgb();return n.r=q(0,j(255,n.r-U(-e/100*255))),n.g=q(0,j(255,n.g-U(-e/100*255))),n.b=q(0,j(255,n.b-U(-e/100*255))),r(n)}function M(t,e){e=0===e?0:e||10;var n=r(t).toHsl();return n.l-=e/100,n.l=E(n.l),r(n)}function b(t,e){var n=r(t).toHsl(),a=(n.h+e)%360;return n.h=a<0?360+a:a,r(n)}function x(t){var e=r(t).toHsl();return e.h=(e.h+180)%360,r(e)}function v(t){var e=r(t).toHsl(),n=e.h;return[r(t),r({h:(n+120)%360,s:e.s,l:e.l}),r({h:(n+240)%360,s:e.s,l:e.l})]}function y(t){var e=r(t).toHsl(),n=e.h;return[r(t),r({h:(n+90)%360,s:e.s,l:e.l}),r({h:(n+180)%360,s:e.s,l:e.l}),r({h:(n+270)%360,s:e.s,l:e.l})]}function S(t){var e=r(t).toHsl(),n=e.h;return[r(t),r({h:(n+72)%360,s:e.s,l:e.l}),r({h:(n+216)%360,s:e.s,l:e.l})]}function I(t,e,n){e=e||6,n=n||30;var a=r(t).toHsl(),i=360/n,o=[r(t)];for(a.h=(a.h-(i*e>>1)+720)%360;--e;)a.h=(a.h+i)%360,o.push(r(a));return o}function A(t,e){e=e||6;for(var n=r(t).toHsv(),a=n.h,i=n.s,o=n.v,s=[],l=1/e;e--;)s.push(r({h:a,s:i,v:o})),o=(o+l)%1;return s}function D(t){return t=parseFloat(t),(isNaN(t)||t<0||t>1)&&(t=1),t}function F(t,r){T(t)&&(t="100%");var n=_(t);return t=j(r,q(0,parseFloat(t))),n&&(t=parseInt(t*r,10)/100),e.abs(t-r)<1e-6?1:t%r/parseFloat(r)}function E(t){return j(1,q(0,t))}function w(t){return parseInt(t,16)}function T(t){return"string"==typeof t&&-1!=t.indexOf(".")&&1===parseFloat(t)}function _(t){return"string"==typeof t&&-1!=t.indexOf("%")}function L(t){return 1==t.length?"0"+t:""+t}function O(t){return t<=1&&(t=100*t+"%"),t}function R(t){return e.round(255*parseFloat(t)).toString(16)}function P(t){return w(t)/255}function C(t){return!!$.CSS_UNIT.exec(t)}function z(t){t=t.replace(H,"").replace(k,"").toLowerCase();var e=!1;if(Y[t])t=Y[t],e=!0;else if("transparent"==t)return{r:0,g:0,b:0,a:0,format:"name"};var r;return(r=$.rgb.exec(t))?{r:r[1],g:r[2],b:r[3]}:(r=$.rgba.exec(t))?{r:r[1],g:r[2],b:r[3],a:r[4]}:(r=$.hsl.exec(t))?{h:r[1],s:r[2],l:r[3]}:(r=$.hsla.exec(t))?{h:r[1],s:r[2],l:r[3],a:r[4]}:(r=$.hsv.exec(t))?{h:r[1],s:r[2],v:r[3]}:(r=$.hsva.exec(t))?{h:r[1],s:r[2],v:r[3],a:r[4]}:(r=$.hex8.exec(t))?{r:w(r[1]),g:w(r[2]),b:w(r[3]),a:P(r[4]),format:e?"name":"hex8"}:(r=$.hex6.exec(t))?{r:w(r[1]),g:w(r[2]),b:w(r[3]),format:e?"name":"hex"}:(r=$.hex4.exec(t))?{r:w(r[1]+""+r[1]),g:w(r[2]+""+r[2]),b:w(r[3]+""+r[3]),a:P(r[4]+""+r[4]),format:e?"name":"hex8"}:!!(r=$.hex3.exec(t))&&{r:w(r[1]+""+r[1]),g:w(r[2]+""+r[2]),b:w(r[3]+""+r[3]),format:e?"name":"hex"}}function N(t){var e,r;return t=t||{level:"AA",size:"small"},e=(t.level||"AA").toUpperCase(),r=(t.size||"small").toLowerCase(),"AA"!==e&&"AAA"!==e&&(e="AA"),"small"!==r&&"large"!==r&&(r="small"),{level:e,size:r}}var H=/^\s+/,k=/\s+$/,V=0,U=e.round,j=e.min,q=e.max,B=e.random;r.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var t=this.toRgb();return(299*t.r+587*t.g+114*t.b)/1e3},getLuminance:function(){var t,r,n,a,i,o,s=this.toRgb();return t=s.r/255,r=s.g/255,n=s.b/255,a=t<=.03928?t/12.92:e.pow((t+.055)/1.055,2.4),i=r<=.03928?r/12.92:e.pow((r+.055)/1.055,2.4),o=n<=.03928?n/12.92:e.pow((n+.055)/1.055,2.4),.2126*a+.7152*i+.0722*o},setAlpha:function(t){return this._a=D(t),this._roundA=U(100*this._a)/100,this},toHsv:function(){var t=s(this._r,this._g,this._b);return{h:360*t.h,s:t.s,v:t.v,a:this._a}},toHsvString:function(){var t=s(this._r,this._g,this._b),e=U(360*t.h),r=U(100*t.s),n=U(100*t.v);return 1==this._a?"hsv("+e+", "+r+"%, "+n+"%)":"hsva("+e+", "+r+"%, "+n+"%, "+this._roundA+")"},toHsl:function(){var t=i(this._r,this._g,this._b);return{h:360*t.h,s:t.s,l:t.l,a:this._a}},toHslString:function(){var t=i(this._r,this._g,this._b),e=U(360*t.h),r=U(100*t.s),n=U(100*t.l);return 1==this._a?"hsl("+e+", "+r+"%, "+n+"%)":"hsla("+e+", "+r+"%, "+n+"%, "+this._roundA+")"},toHex:function(t){return u(this._r,this._g,this._b,t)},toHexString:function(t){return"#"+this.toHex(t)},toHex8:function(t){return c(this._r,this._g,this._b,this._a,t)},toHex8String:function(t){return"#"+this.toHex8(t)},toRgb:function(){return{r:U(this._r),g:U(this._g),b:U(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+U(this._r)+", "+U(this._g)+", "+U(this._b)+")":"rgba("+U(this._r)+", "+U(this._g)+", "+U(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:U(100*F(this._r,255))+"%",g:U(100*F(this._g,255))+"%",b:U(100*F(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+U(100*F(this._r,255))+"%, "+U(100*F(this._g,255))+"%, "+U(100*F(this._b,255))+"%)":"rgba("+U(100*F(this._r,255))+"%, "+U(100*F(this._g,255))+"%, "+U(100*F(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(G[u(this._r,this._g,this._b,!0)]||!1)},toFilter:function(t){var e="#"+h(this._r,this._g,this._b,this._a),n=e,a=this._gradientType?"GradientType = 1, ":"";if(t){var i=r(t);n="#"+h(i._r,i._g,i._b,i._a)}return"progid:DXImageTransform.Microsoft.gradient("+a+"startColorstr="+e+",endColorstr="+n+")"},toString:function(t){var e=!!t;t=t||this._format;var r=!1,n=this._a<1&&this._a>=0;return e||!n||"hex"!==t&&"hex6"!==t&&"hex3"!==t&&"hex4"!==t&&"hex8"!==t&&"name"!==t?("rgb"===t&&(r=this.toRgbString()),"prgb"===t&&(r=this.toPercentageRgbString()),"hex"!==t&&"hex6"!==t||(r=this.toHexString()),"hex3"===t&&(r=this.toHexString(!0)),"hex4"===t&&(r=this.toHex8String(!0)),"hex8"===t&&(r=this.toHex8String()),"name"===t&&(r=this.toName()),"hsl"===t&&(r=this.toHslString()),"hsv"===t&&(r=this.toHsvString()),r||this.toHexString()):"name"===t&&0===this._a?this.toName():this.toRgbString()},clone:function(){return r(this.toString())},_applyModification:function(t,e){var r=t.apply(null,[this].concat([].slice.call(e)));return this._r=r._r,this._g=r._g,this._b=r._b,this.setAlpha(r._a),this},lighten:function(){return this._applyModification(p,arguments)},brighten:function(){return this._applyModification(g,arguments)},darken:function(){return this._applyModification(M,arguments)},desaturate:function(){return this._applyModification(f,arguments)},saturate:function(){return this._applyModification(d,arguments)},greyscale:function(){return this._applyModification(m,arguments)},spin:function(){return this._applyModification(b,arguments)},_applyCombination:function(t,e){return t.apply(null,[this].concat([].slice.call(e)))},analogous:function(){return this._applyCombination(I,arguments)},complement:function(){return this._applyCombination(x,arguments)},monochromatic:function(){return this._applyCombination(A,arguments)},splitcomplement:function(){return this._applyCombination(S,arguments)},triad:function(){return this._applyCombination(v,arguments)},tetrad:function(){return this._applyCombination(y,arguments)}},r.fromRatio=function(t,e){if("object"==typeof t){var n={};for(var a in t)t.hasOwnProperty(a)&&(n[a]="a"===a?t[a]:O(t[a]));t=n}return r(t,e)},r.equals=function(t,e){return!(!t||!e)&&r(t).toRgbString()==r(e).toRgbString()},r.random=function(){return r.fromRatio({r:B(),g:B(),b:B()})},r.mix=function(t,e,n){n=0===n?0:n||50;var a=r(t).toRgb(),i=r(e).toRgb(),o=n/100;return r({r:(i.r-a.r)*o+a.r,g:(i.g-a.g)*o+a.g,b:(i.b-a.b)*o+a.b,a:(i.a-a.a)*o+a.a})},r.readability=function(t,n){var a=r(t),i=r(n);return(e.max(a.getLuminance(),i.getLuminance())+.05)/(e.min(a.getLuminance(),i.getLuminance())+.05)},r.isReadable=function(t,e,n){var a,i,o=r.readability(t,e);switch(i=!1,(a=N(n)).level+a.size){case"AAsmall":case"AAAlarge":i=o>=4.5;break;case"AAlarge":i=o>=3;break;case"AAAsmall":i=o>=7}return i},r.mostReadable=function(t,e,n){var a,i,o,s,l=null,u=0;i=(n=n||{}).includeFallbackColors,o=n.level,s=n.size;for(var c=0;c<e.length;c++)(a=r.readability(t,e[c]))>u&&(u=a,l=r(e[c]));return r.isReadable(t,l,{level:o,size:s})||!i?l:(n.includeFallbackColors=!1,r.mostReadable(t,["#fff","#000"],n))};var Y=r.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},G=r.hexNames=function(t){var e={};for(var r in t)t.hasOwnProperty(r)&&(e[t[r]]=r);return e}(Y),$=function(){var t="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)",e="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?",r="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?";return{CSS_UNIT:new RegExp(t),rgb:new RegExp("rgb"+e),rgba:new RegExp("rgba"+r),hsl:new RegExp("hsl"+e),hsla:new RegExp("hsla"+r),hsv:new RegExp("hsv"+e),hsva:new RegExp("hsva"+r),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();t.exports?t.exports=r:window.tinycolor=r}(Math)});class at{constructor(){this.registry=new Map}registerComponent(t,e){return this.registry.set(t,e),this}createComponent(t,e,r){const n=this.registry.get(e).create(t,r);return t.setComponent(e,n),this}updateComponent(t,e,r){const n=t[e];return this.registry.get(e).update(n,r),this}createOrUpdateComponent(t,e,r){return null!=t[e]?this.updateComponent(t,e,r):this.createComponent(t,e,r),this}}const it=require("uuid/v4"),ot=t=>{var e=!0,r=!1,n=void 0;try{for(var a,i=t.components.keys()[Symbol.iterator]();!(e=(a=i.next()).done);e=!0){const e=a.value;t.destroyComponent(e)}}catch(t){r=!0,n=t}finally{try{!e&&i.return&&i.return()}finally{if(r)throw n}}};class st{constructor(){this.components=new Map,this.id=it(),et(this)}hasComponent(t){return this.components.has(t)}setComponent(t,e){if(this[t])throw new Error(`Component name "${t}" is already assigned!`);return this.components.set(t,e),this[t]=e,e.connectedEntity&&e.connectedEntity(this),this}destroyComponent(t){if(this.components.delete(t)){const e=this[t];delete this[t],e.disconnectedEntity&&e.disconnectedEntity(this)}return this}destroy(){this.emit("destroy",this),ot(this)}}class lt{constructor(){this.entities=new Map}createEntity(){const t=new st;return this.entities.set(t.id,t),t}getEntity(t){return this.entities.get(t)}destroyEntity(t){const e=this.entities.get(t);return!!e&&(e.destroy(),this.entities.delete(t),!0)}}class ut{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.value=t}touch(){++this.value}}class ct{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.resource=t,this.hints=e,this.id=e.id||it(),this.serial=new ut("number"==typeof e.serial?e.serial:1)}isSynced(t){const e=this.serial.value;return e>0&&e===t.serial.value}needSync(t){return!this.isSynced(t)}sync(t,e){this.needSync(t)&&(e(this.resource),this.serial.value=t.serial.value)}}const ht=Object.freeze({float32:4,int16:2,int32:4,int8:1,uint16:2,uint32:4,uint8:1}),ft=Object.freeze({float32:Float32Array,int16:Int16Array,int32:Int32Array,int8:Int8Array,uint16:Uint16Array,uint32:Uint32Array,uint8:Uint8Array}),dt=Object.freeze({float32:t=>t.float32Array,int32:t=>t.int32Array,int16:t=>t.int16Array,int8:t=>t.int8Array,uint32:t=>t.uint32Array,uint16:t=>t.uint16Array,uint8:t=>t.uint8Array}),mt=Object.freeze({float32:"FLOAT",int16:"SHORT",int32:"INT",int8:"BYTE",uint16:"UNSIGNED_SHORT",uint32:"UNSIGNED_INT",uint8:"UNSIGNED_BYTE"});class pt{constructor(t,e,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:pt.USAGE.DYNAMIC,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;this.resourceRef=new ct(this,{usage:n}),this.descriptor=t,this.capacity=e,r instanceof ArrayBuffer?this.float32Array=new Float32Array(r):r instanceof DataView?this.float32Array=new Float32Array(r.buffer,r.byteOffset,r.byteLength/4):r instanceof Float32Array?this.float32Array=r:this.float32Array=new Float32Array(new ArrayBuffer(e*t.bytesPerVO)),this.resourceRef.hints.typedArray=this.float32Array;const i=this.buffer,o=this.bufferByteOffset,s=this.bufferByteLength;t.typeList.filter(t=>"float32"!==t).forEach(t=>{this[`${t}Array`]=new ft[t](i,o,s/ht[t])}),this.enableAutotouch="boolean"==typeof a?a:n===pt.USAGE.DYNAMIC,Object.freeze(this)}touch(){this.resourceRef.serial.touch()}get buffer(){return this.float32Array.buffer}get bufferByteOffset(){return this.float32Array.byteOffset}get bufferByteLength(){return this.float32Array.byteLength}copy(t,e){let r=0;void 0===e&&(r=e*(this.descriptor.bytesPerVO>>2)),this.float32Array.set(t.float32Array,r)}subarray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new pt(this.descriptor,e,new DataView(this.buffer,this.bufferByteOffset+t*this.descriptor.bytesPerVO,e*this.descriptor.bytesPerVO))}}pt.USAGE=Object.freeze({STATIC:"static",DYNAMIC:"dynamic"});class gt{constructor(t,e,r,n,a,i,o){this.name=t,this.type=e,this.size=r,this.uniform=i,this.attrNames=o,this.bytesPerElement=ht[this.type],this.bytesPerVertex=this.bytesPerElement*r,this.byteOffset="number"!=typeof a?n*this.bytesPerElement:a,this.offset="number"!=typeof n?a/this.bytesPerElement:n}vertexAttrCount(t){return t.bytesPerVertex/this.bytesPerElement}static defineProperties(t,e,r){const n=t.name,a=dt[t.type],i=r.vertexCount,o=t.vertexAttrCount(r),m=t.byteOffset/t.bytesPerElement;let p,g;if(1===t.size)if(t.uniform){const r=c(a,m);t.getValue=function(t){return r.call(t)},e[n]={get:r,set:f(a,i,o,m),enumerable:!0}}else{e["set"+d(n)]={value:h(a,1,i,o,m),enumerable:!0};const s=[];for(p=0;p<r.vertexCount;++p){const t=c(a,m+p*o);s.push(t),e[n+p]={get:t,set:h(a,1,1,0,m+p*o),enumerable:!0}}t.getValue=function(t,e){return s[e].call(t)}}else if(t.size>=2)if(t.uniform){const r=l(a,m);for(t.getValue=function(t,e,n){return r.call(t,n)},e["get"+d(n)]={value:r,enumerable:!0},e["set"+d(n)]={value:u(a,t.size,i,o,m),enumerable:!0},p=0;p<t.size;++p)e[s(t,n,p)]={get:c(a,m+p),set:f(a,i,o,m+p),enumerable:!0}}else{e["set"+d(n)]={value:h(a,t.size,i,o,m),enumerable:!0};const l=[];for(p=0;p<r.vertexCount;++p){const r=[];for(g=0;g<t.size;++g){const i=s(t,n,g)+p,l=c(a,m+p*o+g);r.push(l),e[i]={get:l,set:h(a,1,1,0,m+p*o+g),enumerable:!0}}l.push(r)}t.getValue=function(t,e,r){return l[e][r].call(t)}}}}var Mt=function(t,e){const r={toArray:{value:function(e){const r=[],n=Array.isArray(e)?e.map(e=>t.attr[e]):t.attrList,a=n.length;for(let e=0;e<t.vertexCount;++e)for(let t=0;t<a;++t){const a=n[t];for(let t=0;t<a.size;++t)r.push(a.getValue(this,e,t))}return r}}};Object.keys(t.attr).forEach(e=>{const n=t.attr[e];gt.defineProperties(n,r,t)}),t.voPrototype=Object.create("object"==typeof e?e:{},r)},bt=function(t){t.typedArrays={float32:!1,int16:!1,int32:!1,int8:!1,uint16:!1,uint32:!1,uint8:!1},Object.keys(t.attr).forEach(e=>{t.typedArrays[t.attr[e].type]=!0}),Object.freeze(t.typedArrays),t.typeList=Object.keys(t.typedArrays).filter(e=>t.typedArrays[e]).sort()},xt=function(t,e){if(t.attr={},t.attrNames=[],Array.isArray(e)){let r=0,n=0;for(let a=0;a<e.length;++a){const i=e[a];if(void 0===i.size)throw new Error("vertex object attribute descriptor has no size!");const o=i.type||"float32";void 0!==i.name&&(t.attrNames.push(i.name),t.attr[i.name]=new gt(i.name,o,i.size,r,n,!!i.uniform,i.attrNames)),r+=i.size,n+=ht[o]*i.size}t.rightPadBytesPerVertex=n%4>0?4-n%4:0,t.bytesPerVertex=n+t.rightPadBytesPerVertex,t.bytesPerVO=t.bytesPerVertex*t.vertexCount,t.vertexAttrCount=r}t.attrList=t.attrNames.map(e=>t.attr[e])},vt=function(t,e){"object"==typeof e&&Object.keys(e).forEach(r=>{let n=e[r];"string"==typeof n?void 0!==(n=t.attr[n])&&(t.attr[r]=n):t.attr[r]=new gt(r,n.type,n.size,n.offset,n.byteOffset,!!n.uniform,n.attrNames)})};class yt{constructor(t){let e=t.vertexCount,r=t.attributes,n=t.aliases,a=t.proto;this.vertexCount=parseInt(e,10),xt(this,r),vt(this,n),Mt(this,a),bt(this),Object.keys(this.attr).forEach(t=>Object.freeze(this.attr[t])),Object.freeze(this.attr),Object.freeze(this)}createVOArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return new pt(this,t,null,e)}createVO(t){return o(Object.create(this.voPrototype),this,t)}hasAttribute(t,e){const r=this.attr[t];return r&&r.size===e}get maxIndexedVOPoolSize(){return Math.floor(65536/this.vertexCount)}}class St{constructor(t,e){this.id=it(),this.type=t,this.source=e instanceof HTMLElement?e.textContent:e}}St.VERTEX_SHADER="VERTEX_SHADER",St.FRAGMENT_SHADER="FRAGMENT_SHADER";var It=function(t){const e=(t+"").trim();return e.match(/^[0-9]+$/)?e+".0":e},At=(t,e)=>{if(g(e)&&g(t))return t*e;if(g(t))switch(t){case 0:return 0;case 1:return e;default:return`${t} * ${e}`}else{if(!g(e))return`${t} * ${e}`;switch(e){case 0:return 0;case 1:return t;default:return`${t} * ${e}`}}};const Dt=[`\n\n  attribute vec2 pos2d;\n  attribute float posZ;\n  attribute vec2 uv;\n  attribute vec2 translate;\n  attribute float rotate;\n  attribute float scale;\n  attribute float opacity;\n\n  uniform mat4 viewMatrix;\n\n  varying vec4 vTextureCoordScaleOpacity;\n\n  `,function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"rotate",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return[`mat4 ${t}(float angle) {`,"float s = sin(angle);","float c = cos(angle);","float oc = 1.0 - c;",m(p(v(At("oc",e*e),"c"),b(At("oc",e*r),At(n,"s")),v(At("oc",n*e),At(r,"s")),0,v(At("oc",e*r),At(n,"s")),v(At("oc",r*r),"c"),b(At("oc",r*n),At(e,"s")),0,b(At("oc",n*e),At(r,"s")),v(At("oc",r*n),At(e,"s")),v(At("oc",n*n),"c"))),"}"]}("rotateZ",0,0,1),`\n\n  void main(void)\n  {\n    mat4 rotationMatrix = rotateZ(rotate);\n    gl_Position = viewMatrix * ((rotationMatrix * (vec4(scale, scale, scale, 1.0) * vec4(pos2d.xy, posZ, 1.0))) + vec4(translate.xy, 0.0, 0.0));\n    vTextureCoordScaleOpacity = vec4(uv.xy, opacity, 0.0);\n  }\n`],Ft=(`\n\n  precision mediump float;\n\n  varying vec4 vTextureCoordScaleOpacity;\n  uniform sampler2D tex;\n\n  void main(void) {\n    gl_FragColor = vTextureCoordScaleOpacity.z * texture2D(tex, vec2(vTextureCoordScaleOpacity.s, vTextureCoordScaleOpacity.t));\n  }\n\n`,{vertexCount:4,attributes:[{name:"position",type:"float32",size:3,attrNames:["x","y","z"]},{name:"rotate",type:"float32",size:1,uniform:!0},{name:"texCoords",type:"float32",size:2,attrNames:["s","t"]},{name:"translate",type:"float32",size:2,attrNames:["tx","ty"],uniform:!0},{name:"scale",type:"float32",size:1,uniform:!0},{name:"opacity",type:"float32",size:1,uniform:!0}],aliases:{pos2d:{size:2,type:"float32",offset:0},posZ:{size:1,type:"float32",offset:2,uniform:!0},uv:"texCoords"},proto:{setTexCoordsByViewport(t,e,r,n){let a=0===t.x?0:t.x/e,i=(t.x+t.width)/e,o=1-(t.y+t.height)/r,s=0===t.y?1:1-t.y/r;void 0!==n&&(a*=n,i*=n,o*=n,s*=n),this.setTexCoords(a,o,i,o,i,s,a,s)},setTexCoordsByTexture(t){const e=t.minS,r=t.minT,n=t.maxS,a=t.maxT;this.setTexCoords(e,r,n,r,n,a,e,a)},setSize(t,e){const r=.5*t,n=.5*(null==e?t:e);this.setPos2d(-r,n,r,n,r,-n,-r,-n)},get rotateDegree(){return 180*this.rotate/Math.PI},set rotateDegree(t){this.rotate=t*(Math.PI/180)},get z(){return this.z0},set z(t){this.z0=t,this.z1=t,this.z2=t,this.z3=t}}});var Et=function(t){t.addDescriptor("simple",Ft).addVertexShader("simple",Dt).addFragmentShader("simple","\n\n  precision mediump float;\n\n  varying vec4 vTextureCoordScaleOpacity;\n  uniform sampler2D tex;\n\n  void main(void) {\n    gl_FragColor = vTextureCoordScaleOpacity.z * texture2D(tex, vec2(vTextureCoordScaleOpacity.s, vTextureCoordScaleOpacity.t));\n  }\n\n")};class wt{constructor(){this.descriptors=new Map,this.vertexShaders=new Map,this.fragmentShaders=new Map,Et(this)}addDescriptor(t,e){return this.descriptors.set(t,new yt(e)),this}addVertexShader(t,e){return this.vertexShaders.set(t,new St(St.VERTEX_SHADER,e)),this}addFragmentShader(t,e){return this.fragmentShaders.set(t,new St(St.FRAGMENT_SHADER,e)),this}findDescriptor(t){return this.descriptors.get(t)}findVertexShader(t){return this.vertexShaders.get(t)}findFragmentShader(t){return this.fragmentShaders.get(t)}}const Tt=t=>0!==t&&0==(t&t-1);class _t{constructor(t){let e;"string"==typeof t?(e=new window.Image).src=t:e=t,!1===e.complete||0===e.width&&0===e.height?(this.imgEl=null,this.complete=new Promise(t=>{const r=e.onload;e.onload=(()=>{r&&r.call(e),S(this,e),t(this)})})):(S(this,e),this.complete=Promise.resolve(this))}get isComplete(){return null!=this.imgEl}get width(){return this.imgEl&&this.imgEl.width||0}get height(){return this.imgEl&&this.imgEl.height||0}}class Lt{constructor(t,e,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if(t instanceof Lt)this.parent=t,this.image=null;else{if(!("object"==typeof t&&"width"in t&&"height"in t))throw new Error("new Texture() panic: unexpected source argument!");this.image=t,this.parent=null,this._resourceRef=new ct(this,{flipY:!!i&&!0===i.flipY,repeatable:!!i&&!0===i.repeatable,premultiplyAlpha:!!i&&!0===i.premultiplyAlpha}),"origWidth"in t&&"origHeight"in t&&(e=t.origWidth,r=t.origHeight)}this._width=e,this._height=r,this.x=n,this.y=a}get root(){return this.parent&&this.parent.root||this}get imgEl(){const t=this.root;return t.image.imgEl||t.image}get resourceRef(){return this._resourceRef||this.root.resourceRef}get width(){return"number"==typeof this._width?this._width:this.image?this.image.width:this.parent?this.root.width:0}set width(t){this._width=t}get height(){return"number"==typeof this._height?this._height:this.image?this.image.height:this.parent?this.root.height:0}set height(t){this._height=t}get minS(){let t=this.x,e=this;for(;null!=(e=e.parent);)t+=e.x;return t/this.root.image.width}get minT(){let t=this.y,e=this;for(;null!=(e=e.parent);)t+=e.y;return t/this.root.image.height}get maxS(){let t=this.x+this.width,e=this;for(;null!=(e=e.parent);)t+=e.x;return t/this.root.image.width}get maxT(){let t=this.y+this.height,e=this;for(;null!=(e=e.parent);)t+=e.y;return t/this.root.image.height}static load(t){return new _t(t).complete.then(t=>new Lt(t))}}class Ot{constructor(t,e){this.texture=null,this.atlas=null,this.promise=Promise.resolve(t).then(t=>(this.texture=t,t)).catch(t=>{console.error("TextureState error:",t)}),Promise.resolve(e).then(t=>{this.atlas=t})}get isReady(){return null!=this.texture}}class Rt{constructor(t){this.jsonDef=t,this.frameNames=Object.keys(t.frames)}get frames(){return this.jsonDef.frames}get meta(){return this.jsonDef.meta}get imageUrl(){return this.meta.image}createTextureAtlas(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return Promise.resolve(t).then(t=>{if("function"==typeof t)return Promise.resolve(t(this)).then(t=>"string"==typeof t?new _t(t).complete:t);if("string"==typeof t)return new _t(t).complete;if(t)return t;throw new Error("TextureAtlasSpec.createTextureAtlas(): no image found!")}).then(t=>{const e=new Lt(t),r=new Pt(e,this);var n=!0,a=!1,i=void 0;try{for(var o,s=Object.keys(this.frames)[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){let t=o.value;const e=this.frames[t].frame;r.addFrame(t,e.w,e.h,e.x,e.y)}}catch(t){a=!0,i=t}finally{try{!n&&s.return&&s.return()}finally{if(a)throw i}}return r})}static load(t,e){return window.fetch(t,e).then(t=>t.json()).then(t=>new Rt(t))}}class Pt{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.rootTexture=t,this.spec=e,this.frames=new Map}addFrame(t,e,r,n,a){this.frames.set(t,new Lt(this.rootTexture,e,r,n,a))}getFrame(t){return this.frames.get(t)}getRandomFrame(){return A(Array.from(this.frames.values()))}frameNames(){return this.frames.keys()}static load(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Rt.load(t,e||{}).then(t=>t.createTextureAtlas(r||t.imageUrl))}}class Ct{constructor(t,e,r){this.name=t,this.type=e,this._value=r,this.serial=0}get value(){return this._value}set value(t){this._value!==t&&(this._value=t,++this.serial)}touch(){++this.serial}}Ct.TYPE=Object.freeze({UNIFORM:"uniform",ATTRIB:"attrib",TEXTURE_2D:"tex2d"});class zt extends Ct{constructor(t,e){super(t,Ct.TYPE.TEXTURE_2D,e),this.texture=null}syncTextureAndValue(t){if(null!=this.texture){const e=t.syncTexture(this.texture);this.value=e.bind()}}}class Nt{constructor(){this.states=new Map,this.shaderVars=new Map}loadTexture(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;const r=new Ot(Lt.load(e));return this.states.set(t,r),r.promise}loadTextureAtlas(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;const r=Pt.load(e),n=new Ot(r.then(t=>(n.atlas=t,t.rootTexture)));return this.states.set(t,n),r}getTextureAtlas(t){return this.states.get(t).atlas}whenLoaded(t,e,r){const n=this.states.get(t);if(void 0===n||!n.isReady)return;let a=this.shaderVars.get(e);void 0===a&&(a=new zt(e),this.shaderVars.set(e,a)),a.texture=n.texture,r(a)}}class Ht{constructor(t,e){if(this.glx=t,!(e instanceof St))throw new Error("WebGlShader panic! source must be an instance of ShaderSource!");this.source=e;const r=t.gl;this.shaderType=r[e.type],this.glShader=r.createShader(this.shaderType),F(this),Object.freeze(this)}}class kt{constructor(t,e){this.program=t,this.glx=t.glx;const r=t.glx.gl,n=t.glProgram;var a=r.getActiveUniform(n,e);const i=a.name,o=a.size,s=a.type;this.name=i,this.size=o,this.type=s,this.location=r.getUniformLocation(n,i),this.setValue=E(this),Object.freeze(this)}}const Vt=(t,e)=>t[mt[e]];class Ut{constructor(t,e){this.program=t,this.glx=t.glx;const r=t.glx.gl,n=t.glProgram;var a=r.getActiveAttrib(n,e);const i=a.name,o=a.size,s=a.type;this.name=i,this.size=o,this.type=s,this.location=r.getAttribLocation(n,i),Object.freeze(this)}vertexAttribPointer(t){const e=this.glx.gl,r=t.attr[this.name],n=Vt(e,r.type);e.vertexAttribPointer(this.location,r.size,n,!1,t.bytesPerVertex,r.byteOffset)}}class jt{constructor(t,e){this.glx=t,this.vertexShader=t.resourceLibrary.loadVertexShader(e.vertexShader),this.fragmentShader=t.resourceLibrary.loadFragementShader(e.fragmentShader);const r=t.gl;this.glProgram=r.createProgram(),_(this,this.vertexShader.glShader,this.fragmentShader.glShader),T(this),w(this),Object.freeze(this)}use(){const t=this.glx;return!!t.useProgram(this.glProgram)&&(t.enableVertexAttribArrays(this.attributeLocations),!0)}loadUniforms(t,e){this.uniformNames.forEach(r=>{let n=t.curUniform(r);null==n&&(null==(n=t.curTex2d(r))&&console.error("[WebGlProgram] could not load uniform:",r),n.syncTextureAndValue(e)),this.uniforms[r].setValue(n.value)})}loadAttributes(t,e){this.attributeNames.forEach(r=>{const n=t.curAttrib(r).value;e.syncBuffer(n).bindBuffer(),this.attributes[r].vertexAttribPointer(n.descriptor)})}}class qt{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:qt.ARRAY_BUFFER,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:qt.STATIC_DRAW;this.glx=t;const n=t.gl;this.target=n[e],this.usage=n[r],this.glBuffer=n.createBuffer()}bindBuffer(){this.glx.bindBuffer(this.target,this.glBuffer)}bufferData(t){this.bindBuffer(),this.glx.gl.bufferData(this.target,t,this.usage)}}qt.ARRAY_BUFFER="ARRAY_BUFFER",qt.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",qt.STATIC_DRAW="STATIC_DRAW",qt.DYNAMIC_DRAW="DYNAMIC_DRAW";class Bt{constructor(t,e){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.glx=t,this.imgEl=e,this.flipY=r,this.repeatable=n,this.premultiplyAlpha=a,this.isInitialized=!1,this.glTexObj=t.gl.createTexture(),this.texUnit=-1}bind(){return this.glx.textureManager.bindWebGlTexture(this)}uploadImageData(){if(null==this.imgEl)return;this.isInitialized||(L(this),this.isInitialized=!0),this.bind();const t=this.glx.gl;t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.imgEl)}}const Yt=Object.freeze({static:qt.STATIC_DRAW,dynamic:qt.DYNAMIC_DRAW});class Gt{constructor(t){Object.defineProperty(this,"glx",{value:t}),this.vertexShader=new Map,this.fragmentShader=new Map,this.shaderProgram=new Map,this.buffer=new Map,this.texture=new Map}loadVertexShader(t){let e=this.vertexShader.get(t.id);return e||(e=new Ht(this.glx,t),this.vertexShader.set(t.id,e)),e}loadFragementShader(t){let e=this.fragmentShader.get(t.id);return e||(e=new Ht(this.glx,t),this.vertexShader.set(t.id,e)),e}loadProgram(t){let e=this.shaderProgram.get(t.id);return e||(e=new jt(this.glx,t),this.shaderProgram.set(t.id,e)),e}loadBuffer(t){let e=this.buffer.get(t.id);if(!e){const r=t.hints.target||qt.ARRAY_BUFFER,n=new qt(this.glx,r,Yt[t.hints.usage]);e=new ct(n,{id:t.id,serial:0}),this.buffer.set(t.id,e)}return e}findBuffer(t){return this.buffer.get(t.id)}loadTexture(t){let e=this.texture.get(t.id);if(!e){const r=new Bt(this.glx,t.resource.imgEl,t.hints.flipY,t.hints.repeatable,t.hints.premultiplyAlpha);e=new ct(r,{id:t.id,serial:0}),this.texture.set(t.id,e)}return e}}class $t{constructor(t){Object.defineProperty(this,"glx",{value:t}),this.boundTextures=new Array(t.MAX_TEXTURE_IMAGE_UNITS);for(let t=0;t<this.boundTextures.length;++t)this.boundTextures[t]=null;this.lastBoundTexUnit=0}bindWebGlTexture(t){let e=this.boundTextures.indexOf(t);if(e<0){for(let r=0;r<this.boundTextures.length;++r)if(!this.boundTextures[r]){e=r,this.boundTextures[r]=t;break}if(e<0){e=this.lastBoundTexUnit;let t=this.boundTextures[e];t&&(t.texUnit=-1),this.lastBoundTexUnit=(this.lastBoundTexUnit+1)%this.glx.MAX_TEXTURE_IMAGE_UNITS}this.glx.activeTexture(e),this.glx.bindTexture2d(t.glTexObj),t.texUnit=e}return e}}class Xt{constructor(t){Object.defineProperty(this,"gl",{value:t}),O(this),this.resourceLibrary=new Gt(this),this.boundBuffers=new Map,this.currentProgram=0,this.enabledVertexAttribLocations=[],this.textureManager=new $t(this),this.boundTextures=new Array(this.MAX_TEXTURE_IMAGE_UNITS);for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]={TEXTURE_2D:null};this.activeTexture(0)}activeTexture(t){const e=this.gl,r=e.TEXTURE0+t;this.activeTexUnit!==r&&(this.activeTexUnit=r,e.activeTexture(this.activeTexUnit))}bindTexture2d(t){const e=this.gl,r=this.boundTextures[this.activeTexUnit-e.TEXTURE0];r.TEXTURE_2D!==t&&(r.TEXTURE_2D=t,e.bindTexture(e.TEXTURE_2D,t))}readCurrentState(){const t=this.gl;this.boundBuffers.set(t.ARRAY_BUFFER,t.getParameter(t.ARRAY_BUFFER_BINDING)),this.boundBuffers.set(t.ELEMENT_ARRAY_BUFFER,t.getParameter(t.ELEMENT_ARRAY_BUFFER_BINDING)),this.currentProgram=t.getParameter(t.CURRENT_PROGRAM)}bindBuffer(t,e){this.boundBuffers.get(t)!==e&&(this.gl.bindBuffer(t,e),this.boundBuffers.set(t,e))}useProgram(t){return this.currentProgram!==t&&(this.gl.useProgram(t),this.currentProgram=t,!0)}enableVertexAttribArrays(t){const e=this.gl;this.enabledVertexAttribLocations.filter(e=>-1===t.indexOf(e)).forEach(r=>{e.disableVertexAttribArray(r),this.enabledVertexAttribLocations.splice(t.indexOf(r),1)}),t.forEach(t=>{-1===this.enabledVertexAttribLocations.indexOf(t)&&(e.enableVertexAttribArray(t),this.enabledVertexAttribLocations.push(t))})}}class Wt{constructor(t){this.shaderVars=t}pushVar(t){this.shaderVars.forEach(t.pushVar.bind(t))}popVar(t){this.shaderVars.forEach(t.popVar.bind(t))}}class Zt{constructor(){this.uniform=new Map,this.attrib=new Map,this.tex2d=new Map}clear(){this.uniform.clear(),this.attrib.clear(),this.tex2d.clear()}pushVar(t){t instanceof Wt?t.pushVar(this):P(this,t.type,t.name).push(t)}popVar(t){if(t instanceof Wt)t.popVar(this);else{const e=P(this,t.type,t.name),r=e.length;for(let n=0;n<r;++n)if(e[n]===t)return void(e.length=n)}}curVar(t){const e=R(this,t.type).get(t.name);return e&&e.length?e[e.length-1]:null}curUniform(t){const e=this.uniform.get(t);return e&&e.length?e[e.length-1]:null}curAttrib(t){const e=this.attrib.get(t);return e&&e.length?e[e.length-1]:null}curTex2d(t){const e=this.tex2d.get(t);return e&&e.length?e[e.length-1]:null}}const Kt=(t,e)=>{const r=e.resource;r.enableAutotouch&&(t.autotouchResources.has(e.id)||(t.autotouchResources.set(e.id,!0),r.touch()))};class Qt{constructor(t){Object.defineProperty(this,"glx",{value:t}),this.shaderContext=new Zt,this.autotouchResources=new Map,this.frameNo=0,this.clearColor=null,et(this)}setClearColor(t){this.clearColor=nt(t)}renderFrame(t,e){++this.frameNo,this.shaderContext.clear(),t.emit("animateFrame",e),this.beginRenderFrame(),t.emit("renderFrame",this),this.endRenderFrame()}beginRenderFrame(){this.clearFrameBuffer()}endRenderFrame(){this.autotouchResources.clear()}clearFrameBuffer(){const t=this.glx.gl;let e=t.COLOR_BUFFER_BIT;if(this.glx.DEPTH_BITS>0&&(e|=t.DEPTH_BUFFER_BIT),null!==this.clearColor){const e=this.clearColor.toRgb();t.clearColor(e.r/255,e.g/255,e.b/255,e.a)}t.clear(e)}useShaderProgram(t){const e=this.glx.resourceLibrary.loadProgram(t),r=this.shaderContext;e.use(r),e.loadUniforms(r,this),e.loadAttributes(r,this)}drawArrays(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=this.glx.gl;n.drawArrays(n[t],r,e)}drawIndexed(t,e,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const a=this.glx.gl;this.syncBuffer(e).bindBuffer(),a.drawElements(a[t],r||e.length,a.UNSIGNED_SHORT,n*e.array.BYTES_PER_ELEMENT)}syncBuffer(t){const e=t.resourceRef;Kt(this,e);const r=this.glx.resourceLibrary.loadBuffer(e);return r.sync(e,t=>t.bufferData(e.hints.typedArray)),r.resource}syncTexture(t){const e=t.resourceRef,r=this.glx.resourceLibrary.loadTexture(e);return r.sync(e,t=>t.uploadImageData()),r.resource}}var Jt=function(){function t(t,e){var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){a=!0,i=t}finally{try{!n&&s.return&&s.return()}finally{if(a)throw i}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),te=function(t){if("string"!=typeof t)return t;const e=t.trim();if(e.startsWith("{")&&e.endsWith("}"))return JSON.parse(e);if(e.includes(";")||e.includes(":")){const t={},r=e.split(";");for(let e=0;e<r.length;++e)z(t,r[e].trim());return t}return C(e)},ee={};ee.EPSILON=1e-6,ee.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,ee.RANDOM=Math.random,ee.ENABLE_SIMD=!1,ee.SIMD_AVAILABLE=ee.ARRAY_TYPE===Float32Array&&"SIMD"in rt,ee.USE_SIMD=ee.ENABLE_SIMD&&ee.SIMD_AVAILABLE,ee.setMatrixArrayType=function(t){ee.ARRAY_TYPE=t};var re=Math.PI/180;ee.toRadian=function(t){return t*re},ee.equals=function(t,e){return Math.abs(t-e)<=ee.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))};var ne=ee,ae={};ae.create=function(){var t=new ne.ARRAY_TYPE(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},ae.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},ae.clone=function(t){var e=new ne.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},ae.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},ae.fromValues=function(t,e,r,n,a,i,o,s,l){var u=new ne.ARRAY_TYPE(9);return u[0]=t,u[1]=e,u[2]=r,u[3]=n,u[4]=a,u[5]=i,u[6]=o,u[7]=s,u[8]=l,u},ae.set=function(t,e,r,n,a,i,o,s,l,u){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t[4]=i,t[5]=o,t[6]=s,t[7]=l,t[8]=u,t},ae.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},ae.transpose=function(t,e){if(t===e){var r=e[1],n=e[2],a=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=a}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},ae.invert=function(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],o=e[4],s=e[5],l=e[6],u=e[7],c=e[8],h=c*o-s*u,f=-c*i+s*l,d=u*i-o*l,m=r*h+n*f+a*d;return m?(m=1/m,t[0]=h*m,t[1]=(-c*n+a*u)*m,t[2]=(s*n-a*o)*m,t[3]=f*m,t[4]=(c*r-a*l)*m,t[5]=(-s*r+a*i)*m,t[6]=d*m,t[7]=(-u*r+n*l)*m,t[8]=(o*r-n*i)*m,t):null},ae.adjoint=function(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],o=e[4],s=e[5],l=e[6],u=e[7],c=e[8];return t[0]=o*c-s*u,t[1]=a*u-n*c,t[2]=n*s-a*o,t[3]=s*l-i*c,t[4]=r*c-a*l,t[5]=a*i-r*s,t[6]=i*u-o*l,t[7]=n*l-r*u,t[8]=r*o-n*i,t},ae.determinant=function(t){var e=t[0],r=t[1],n=t[2],a=t[3],i=t[4],o=t[5],s=t[6],l=t[7],u=t[8];return e*(u*i-o*l)+r*(-u*a+o*s)+n*(l*a-i*s)},ae.multiply=function(t,e,r){var n=e[0],a=e[1],i=e[2],o=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],f=r[0],d=r[1],m=r[2],p=r[3],g=r[4],M=r[5],b=r[6],x=r[7],v=r[8];return t[0]=f*n+d*o+m*u,t[1]=f*a+d*s+m*c,t[2]=f*i+d*l+m*h,t[3]=p*n+g*o+M*u,t[4]=p*a+g*s+M*c,t[5]=p*i+g*l+M*h,t[6]=b*n+x*o+v*u,t[7]=b*a+x*s+v*c,t[8]=b*i+x*l+v*h,t},ae.mul=ae.multiply,ae.translate=function(t,e,r){var n=e[0],a=e[1],i=e[2],o=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],f=r[0],d=r[1];return t[0]=n,t[1]=a,t[2]=i,t[3]=o,t[4]=s,t[5]=l,t[6]=f*n+d*o+u,t[7]=f*a+d*s+c,t[8]=f*i+d*l+h,t},ae.rotate=function(t,e,r){var n=e[0],a=e[1],i=e[2],o=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],f=Math.sin(r),d=Math.cos(r);return t[0]=d*n+f*o,t[1]=d*a+f*s,t[2]=d*i+f*l,t[3]=d*o-f*n,t[4]=d*s-f*a,t[5]=d*l-f*i,t[6]=u,t[7]=c,t[8]=h,t},ae.scale=function(t,e,r){var n=r[0],a=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=a*e[3],t[4]=a*e[4],t[5]=a*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},ae.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},ae.fromRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},ae.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},ae.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},ae.fromQuat=function(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],o=r+r,s=n+n,l=a+a,u=r*o,c=n*o,h=n*s,f=a*o,d=a*s,m=a*l,p=i*o,g=i*s,M=i*l;return t[0]=1-h-m,t[3]=c-M,t[6]=f+g,t[1]=c+M,t[4]=1-u-m,t[7]=d-p,t[2]=f-g,t[5]=d+p,t[8]=1-u-h,t},ae.normalFromMat4=function(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],o=e[4],s=e[5],l=e[6],u=e[7],c=e[8],h=e[9],f=e[10],d=e[11],m=e[12],p=e[13],g=e[14],M=e[15],b=r*s-n*o,x=r*l-a*o,v=r*u-i*o,y=n*l-a*s,S=n*u-i*s,I=a*u-i*l,A=c*p-h*m,D=c*g-f*m,F=c*M-d*m,E=h*g-f*p,w=h*M-d*p,T=f*M-d*g,_=b*T-x*w+v*E+y*F-S*D+I*A;return _?(_=1/_,t[0]=(s*T-l*w+u*E)*_,t[1]=(l*F-o*T-u*D)*_,t[2]=(o*w-s*F+u*A)*_,t[3]=(a*w-n*T-i*E)*_,t[4]=(r*T-a*F+i*D)*_,t[5]=(n*F-r*w-i*A)*_,t[6]=(p*I-g*S+M*y)*_,t[7]=(g*v-m*I-M*x)*_,t[8]=(m*S-p*v+M*b)*_,t):null},ae.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},ae.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},ae.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t},ae.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t},ae.sub=ae.subtract,ae.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t},ae.multiplyScalarAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t},ae.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},ae.equals=function(t,e){var r=t[0],n=t[1],a=t[2],i=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8],h=e[0],f=e[1],d=e[2],m=e[3],p=e[4],g=e[5],M=t[6],b=e[7],x=e[8];return Math.abs(r-h)<=ne.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(n-f)<=ne.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(a-d)<=ne.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(i-m)<=ne.EPSILON*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(o-p)<=ne.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(s-g)<=ne.EPSILON*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(l-M)<=ne.EPSILON*Math.max(1,Math.abs(l),Math.abs(M))&&Math.abs(u-b)<=ne.EPSILON*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(c-x)<=ne.EPSILON*Math.max(1,Math.abs(c),Math.abs(x))};var ie=ae,oe={scalar:{},SIMD:{}};oe.create=function(){var t=new ne.ARRAY_TYPE(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},oe.clone=function(t){var e=new ne.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},oe.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},oe.fromValues=function(t,e,r,n,a,i,o,s,l,u,c,h,f,d,m,p){var g=new ne.ARRAY_TYPE(16);return g[0]=t,g[1]=e,g[2]=r,g[3]=n,g[4]=a,g[5]=i,g[6]=o,g[7]=s,g[8]=l,g[9]=u,g[10]=c,g[11]=h,g[12]=f,g[13]=d,g[14]=m,g[15]=p,g},oe.set=function(t,e,r,n,a,i,o,s,l,u,c,h,f,d,m,p,g){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t[4]=i,t[5]=o,t[6]=s,t[7]=l,t[8]=u,t[9]=c,t[10]=h,t[11]=f,t[12]=d,t[13]=m,t[14]=p,t[15]=g,t},oe.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},oe.scalar.transpose=function(t,e){if(t===e){var r=e[1],n=e[2],a=e[3],i=e[6],o=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=i,t[11]=e[14],t[12]=a,t[13]=o,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},oe.SIMD.transpose=function(t,e){var r,n,a,i,o,s,l,u,c,h;return r=SIMD.Float32x4.load(e,0),n=SIMD.Float32x4.load(e,4),a=SIMD.Float32x4.load(e,8),i=SIMD.Float32x4.load(e,12),o=SIMD.Float32x4.shuffle(r,n,0,1,4,5),s=SIMD.Float32x4.shuffle(a,i,0,1,4,5),l=SIMD.Float32x4.shuffle(o,s,0,2,4,6),u=SIMD.Float32x4.shuffle(o,s,1,3,5,7),SIMD.Float32x4.store(t,0,l),SIMD.Float32x4.store(t,4,u),o=SIMD.Float32x4.shuffle(r,n,2,3,6,7),s=SIMD.Float32x4.shuffle(a,i,2,3,6,7),c=SIMD.Float32x4.shuffle(o,s,0,2,4,6),h=SIMD.Float32x4.shuffle(o,s,1,3,5,7),SIMD.Float32x4.store(t,8,c),SIMD.Float32x4.store(t,12,h),t},oe.transpose=ne.USE_SIMD?oe.SIMD.transpose:oe.scalar.transpose,oe.scalar.invert=function(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],o=e[4],s=e[5],l=e[6],u=e[7],c=e[8],h=e[9],f=e[10],d=e[11],m=e[12],p=e[13],g=e[14],M=e[15],b=r*s-n*o,x=r*l-a*o,v=r*u-i*o,y=n*l-a*s,S=n*u-i*s,I=a*u-i*l,A=c*p-h*m,D=c*g-f*m,F=c*M-d*m,E=h*g-f*p,w=h*M-d*p,T=f*M-d*g,_=b*T-x*w+v*E+y*F-S*D+I*A;return _?(_=1/_,t[0]=(s*T-l*w+u*E)*_,t[1]=(a*w-n*T-i*E)*_,t[2]=(p*I-g*S+M*y)*_,t[3]=(f*S-h*I-d*y)*_,t[4]=(l*F-o*T-u*D)*_,t[5]=(r*T-a*F+i*D)*_,t[6]=(g*v-m*I-M*x)*_,t[7]=(c*I-f*v+d*x)*_,t[8]=(o*w-s*F+u*A)*_,t[9]=(n*F-r*w-i*A)*_,t[10]=(m*S-p*v+M*b)*_,t[11]=(h*v-c*S-d*b)*_,t[12]=(s*D-o*E-l*A)*_,t[13]=(r*E-n*D+a*A)*_,t[14]=(p*x-m*y-g*b)*_,t[15]=(c*y-h*x+f*b)*_,t):null},oe.SIMD.invert=function(t,e){var r,n,a,i,o,s,l,u,c,h,f=SIMD.Float32x4.load(e,0),d=SIMD.Float32x4.load(e,4),m=SIMD.Float32x4.load(e,8),p=SIMD.Float32x4.load(e,12);return o=SIMD.Float32x4.shuffle(f,d,0,1,4,5),n=SIMD.Float32x4.shuffle(m,p,0,1,4,5),r=SIMD.Float32x4.shuffle(o,n,0,2,4,6),n=SIMD.Float32x4.shuffle(n,o,1,3,5,7),o=SIMD.Float32x4.shuffle(f,d,2,3,6,7),i=SIMD.Float32x4.shuffle(m,p,2,3,6,7),a=SIMD.Float32x4.shuffle(o,i,0,2,4,6),i=SIMD.Float32x4.shuffle(i,o,1,3,5,7),o=SIMD.Float32x4.mul(a,i),o=SIMD.Float32x4.swizzle(o,1,0,3,2),s=SIMD.Float32x4.mul(n,o),l=SIMD.Float32x4.mul(r,o),o=SIMD.Float32x4.swizzle(o,2,3,0,1),s=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,o),s),l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,o),l),l=SIMD.Float32x4.swizzle(l,2,3,0,1),o=SIMD.Float32x4.mul(n,a),o=SIMD.Float32x4.swizzle(o,1,0,3,2),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(i,o),s),c=SIMD.Float32x4.mul(r,o),o=SIMD.Float32x4.swizzle(o,2,3,0,1),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(i,o)),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,o),c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),o=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(n,2,3,0,1),i),o=SIMD.Float32x4.swizzle(o,1,0,3,2),a=SIMD.Float32x4.swizzle(a,2,3,0,1),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,o),s),u=SIMD.Float32x4.mul(r,o),o=SIMD.Float32x4.swizzle(o,2,3,0,1),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(a,o)),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,o),u),u=SIMD.Float32x4.swizzle(u,2,3,0,1),o=SIMD.Float32x4.mul(r,n),o=SIMD.Float32x4.swizzle(o,1,0,3,2),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(i,o),u),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,o),c),o=SIMD.Float32x4.swizzle(o,2,3,0,1),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,o),u),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(a,o)),o=SIMD.Float32x4.mul(r,i),o=SIMD.Float32x4.swizzle(o,1,0,3,2),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(a,o)),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,o),u),o=SIMD.Float32x4.swizzle(o,2,3,0,1),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,o),l),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(n,o)),o=SIMD.Float32x4.mul(r,a),o=SIMD.Float32x4.swizzle(o,1,0,3,2),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(i,o),l),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(n,o)),o=SIMD.Float32x4.swizzle(o,2,3,0,1),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(i,o)),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,o),c),h=SIMD.Float32x4.mul(r,s),h=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(h,2,3,0,1),h),h=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(h,1,0,3,2),h),o=SIMD.Float32x4.reciprocalApproximation(h),h=SIMD.Float32x4.sub(SIMD.Float32x4.add(o,o),SIMD.Float32x4.mul(h,SIMD.Float32x4.mul(o,o))),(h=SIMD.Float32x4.swizzle(h,0,0,0,0))?(SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(h,s)),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(h,l)),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(h,u)),SIMD.Float32x4.store(t,12,SIMD.Float32x4.mul(h,c)),t):null},oe.invert=ne.USE_SIMD?oe.SIMD.invert:oe.scalar.invert,oe.scalar.adjoint=function(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],o=e[4],s=e[5],l=e[6],u=e[7],c=e[8],h=e[9],f=e[10],d=e[11],m=e[12],p=e[13],g=e[14],M=e[15];return t[0]=s*(f*M-d*g)-h*(l*M-u*g)+p*(l*d-u*f),t[1]=-(n*(f*M-d*g)-h*(a*M-i*g)+p*(a*d-i*f)),t[2]=n*(l*M-u*g)-s*(a*M-i*g)+p*(a*u-i*l),t[3]=-(n*(l*d-u*f)-s*(a*d-i*f)+h*(a*u-i*l)),t[4]=-(o*(f*M-d*g)-c*(l*M-u*g)+m*(l*d-u*f)),t[5]=r*(f*M-d*g)-c*(a*M-i*g)+m*(a*d-i*f),t[6]=-(r*(l*M-u*g)-o*(a*M-i*g)+m*(a*u-i*l)),t[7]=r*(l*d-u*f)-o*(a*d-i*f)+c*(a*u-i*l),t[8]=o*(h*M-d*p)-c*(s*M-u*p)+m*(s*d-u*h),t[9]=-(r*(h*M-d*p)-c*(n*M-i*p)+m*(n*d-i*h)),t[10]=r*(s*M-u*p)-o*(n*M-i*p)+m*(n*u-i*s),t[11]=-(r*(s*d-u*h)-o*(n*d-i*h)+c*(n*u-i*s)),t[12]=-(o*(h*g-f*p)-c*(s*g-l*p)+m*(s*f-l*h)),t[13]=r*(h*g-f*p)-c*(n*g-a*p)+m*(n*f-a*h),t[14]=-(r*(s*g-l*p)-o*(n*g-a*p)+m*(n*l-a*s)),t[15]=r*(s*f-l*h)-o*(n*f-a*h)+c*(n*l-a*s),t},oe.SIMD.adjoint=function(t,e){var r,n,a,i,o,s,l,u,c,h=SIMD.Float32x4.load(e,0),f=SIMD.Float32x4.load(e,4),d=SIMD.Float32x4.load(e,8),m=SIMD.Float32x4.load(e,12);return o=SIMD.Float32x4.shuffle(h,f,0,1,4,5),n=SIMD.Float32x4.shuffle(d,m,0,1,4,5),r=SIMD.Float32x4.shuffle(o,n,0,2,4,6),n=SIMD.Float32x4.shuffle(n,o,1,3,5,7),o=SIMD.Float32x4.shuffle(h,f,2,3,6,7),i=SIMD.Float32x4.shuffle(d,m,2,3,6,7),a=SIMD.Float32x4.shuffle(o,i,0,2,4,6),i=SIMD.Float32x4.shuffle(i,o,1,3,5,7),o=SIMD.Float32x4.mul(a,i),o=SIMD.Float32x4.swizzle(o,1,0,3,2),s=SIMD.Float32x4.mul(n,o),l=SIMD.Float32x4.mul(r,o),o=SIMD.Float32x4.swizzle(o,2,3,0,1),s=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,o),s),l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,o),l),l=SIMD.Float32x4.swizzle(l,2,3,0,1),o=SIMD.Float32x4.mul(n,a),o=SIMD.Float32x4.swizzle(o,1,0,3,2),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(i,o),s),c=SIMD.Float32x4.mul(r,o),o=SIMD.Float32x4.swizzle(o,2,3,0,1),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(i,o)),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,o),c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),o=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(n,2,3,0,1),i),o=SIMD.Float32x4.swizzle(o,1,0,3,2),a=SIMD.Float32x4.swizzle(a,2,3,0,1),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,o),s),u=SIMD.Float32x4.mul(r,o),o=SIMD.Float32x4.swizzle(o,2,3,0,1),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(a,o)),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,o),u),u=SIMD.Float32x4.swizzle(u,2,3,0,1),o=SIMD.Float32x4.mul(r,n),o=SIMD.Float32x4.swizzle(o,1,0,3,2),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(i,o),u),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,o),c),o=SIMD.Float32x4.swizzle(o,2,3,0,1),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,o),u),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(a,o)),o=SIMD.Float32x4.mul(r,i),o=SIMD.Float32x4.swizzle(o,1,0,3,2),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(a,o)),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,o),u),o=SIMD.Float32x4.swizzle(o,2,3,0,1),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,o),l),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(n,o)),o=SIMD.Float32x4.mul(r,a),o=SIMD.Float32x4.swizzle(o,1,0,3,2),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(i,o),l),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(n,o)),o=SIMD.Float32x4.swizzle(o,2,3,0,1),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(i,o)),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,o),c),SIMD.Float32x4.store(t,0,s),SIMD.Float32x4.store(t,4,l),SIMD.Float32x4.store(t,8,u),SIMD.Float32x4.store(t,12,c),t},oe.adjoint=ne.USE_SIMD?oe.SIMD.adjoint:oe.scalar.adjoint,oe.determinant=function(t){var e=t[0],r=t[1],n=t[2],a=t[3],i=t[4],o=t[5],s=t[6],l=t[7],u=t[8],c=t[9],h=t[10],f=t[11],d=t[12],m=t[13],p=t[14],g=t[15];return(e*o-r*i)*(h*g-f*p)-(e*s-n*i)*(c*g-f*m)+(e*l-a*i)*(c*p-h*m)+(r*s-n*o)*(u*g-f*d)-(r*l-a*o)*(u*p-h*d)+(n*l-a*s)*(u*m-c*d)},oe.SIMD.multiply=function(t,e,r){var n=SIMD.Float32x4.load(e,0),a=SIMD.Float32x4.load(e,4),i=SIMD.Float32x4.load(e,8),o=SIMD.Float32x4.load(e,12),s=SIMD.Float32x4.load(r,0),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,0,0,0,0),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,1,1,1,1),a),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,2,2,2,2),i),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,3,3,3,3),o))));SIMD.Float32x4.store(t,0,l);var u=SIMD.Float32x4.load(r,4),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,0,0,0,0),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,1,1,1,1),a),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,2,2,2,2),i),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,3,3,3,3),o))));SIMD.Float32x4.store(t,4,c);var h=SIMD.Float32x4.load(r,8),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,0,0,0,0),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,1,1,1,1),a),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,2,2,2,2),i),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,3,3,3,3),o))));SIMD.Float32x4.store(t,8,f);var d=SIMD.Float32x4.load(r,12),m=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,0,0,0,0),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,1,1,1,1),a),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,2,2,2,2),i),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,3,3,3,3),o))));return SIMD.Float32x4.store(t,12,m),t},oe.scalar.multiply=function(t,e,r){var n=e[0],a=e[1],i=e[2],o=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],f=e[9],d=e[10],m=e[11],p=e[12],g=e[13],M=e[14],b=e[15],x=r[0],v=r[1],y=r[2],S=r[3];return t[0]=x*n+v*s+y*h+S*p,t[1]=x*a+v*l+y*f+S*g,t[2]=x*i+v*u+y*d+S*M,t[3]=x*o+v*c+y*m+S*b,x=r[4],v=r[5],y=r[6],S=r[7],t[4]=x*n+v*s+y*h+S*p,t[5]=x*a+v*l+y*f+S*g,t[6]=x*i+v*u+y*d+S*M,t[7]=x*o+v*c+y*m+S*b,x=r[8],v=r[9],y=r[10],S=r[11],t[8]=x*n+v*s+y*h+S*p,t[9]=x*a+v*l+y*f+S*g,t[10]=x*i+v*u+y*d+S*M,t[11]=x*o+v*c+y*m+S*b,x=r[12],v=r[13],y=r[14],S=r[15],t[12]=x*n+v*s+y*h+S*p,t[13]=x*a+v*l+y*f+S*g,t[14]=x*i+v*u+y*d+S*M,t[15]=x*o+v*c+y*m+S*b,t},oe.multiply=ne.USE_SIMD?oe.SIMD.multiply:oe.scalar.multiply,oe.mul=oe.multiply,oe.scalar.translate=function(t,e,r){var n,a,i,o,s,l,u,c,h,f,d,m,p=r[0],g=r[1],M=r[2];return e===t?(t[12]=e[0]*p+e[4]*g+e[8]*M+e[12],t[13]=e[1]*p+e[5]*g+e[9]*M+e[13],t[14]=e[2]*p+e[6]*g+e[10]*M+e[14],t[15]=e[3]*p+e[7]*g+e[11]*M+e[15]):(n=e[0],a=e[1],i=e[2],o=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],f=e[9],d=e[10],m=e[11],t[0]=n,t[1]=a,t[2]=i,t[3]=o,t[4]=s,t[5]=l,t[6]=u,t[7]=c,t[8]=h,t[9]=f,t[10]=d,t[11]=m,t[12]=n*p+s*g+h*M+e[12],t[13]=a*p+l*g+f*M+e[13],t[14]=i*p+u*g+d*M+e[14],t[15]=o*p+c*g+m*M+e[15]),t},oe.SIMD.translate=function(t,e,r){var n=SIMD.Float32x4.load(e,0),a=SIMD.Float32x4.load(e,4),i=SIMD.Float32x4.load(e,8),o=SIMD.Float32x4.load(e,12),s=SIMD.Float32x4(r[0],r[1],r[2],0);e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11]),n=SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(s,0,0,0,0)),a=SIMD.Float32x4.mul(a,SIMD.Float32x4.swizzle(s,1,1,1,1)),i=SIMD.Float32x4.mul(i,SIMD.Float32x4.swizzle(s,2,2,2,2));var l=SIMD.Float32x4.add(n,SIMD.Float32x4.add(a,SIMD.Float32x4.add(i,o)));return SIMD.Float32x4.store(t,12,l),t},oe.translate=ne.USE_SIMD?oe.SIMD.translate:oe.scalar.translate,oe.scalar.scale=function(t,e,r){var n=r[0],a=r[1],i=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},oe.SIMD.scale=function(t,e,r){var n,a,i,o=SIMD.Float32x4(r[0],r[1],r[2],0);return n=SIMD.Float32x4.load(e,0),SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(o,0,0,0,0))),a=SIMD.Float32x4.load(e,4),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(a,SIMD.Float32x4.swizzle(o,1,1,1,1))),i=SIMD.Float32x4.load(e,8),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(i,SIMD.Float32x4.swizzle(o,2,2,2,2))),t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},oe.scale=ne.USE_SIMD?oe.SIMD.scale:oe.scalar.scale,oe.rotate=function(t,e,r,n){var a,i,o,s,l,u,c,h,f,d,m,p,g,M,b,x,v,y,S,I,A,D,F,E,w=n[0],T=n[1],_=n[2],L=Math.sqrt(w*w+T*T+_*_);return Math.abs(L)<ne.EPSILON?null:(L=1/L,w*=L,T*=L,_*=L,a=Math.sin(r),i=Math.cos(r),o=1-i,s=e[0],l=e[1],u=e[2],c=e[3],h=e[4],f=e[5],d=e[6],m=e[7],p=e[8],g=e[9],M=e[10],b=e[11],x=w*w*o+i,v=T*w*o+_*a,y=_*w*o-T*a,S=w*T*o-_*a,I=T*T*o+i,A=_*T*o+w*a,D=w*_*o+T*a,F=T*_*o-w*a,E=_*_*o+i,t[0]=s*x+h*v+p*y,t[1]=l*x+f*v+g*y,t[2]=u*x+d*v+M*y,t[3]=c*x+m*v+b*y,t[4]=s*S+h*I+p*A,t[5]=l*S+f*I+g*A,t[6]=u*S+d*I+M*A,t[7]=c*S+m*I+b*A,t[8]=s*D+h*F+p*E,t[9]=l*D+f*F+g*E,t[10]=u*D+d*F+M*E,t[11]=c*D+m*F+b*E,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},oe.scalar.rotateX=function(t,e,r){var n=Math.sin(r),a=Math.cos(r),i=e[4],o=e[5],s=e[6],l=e[7],u=e[8],c=e[9],h=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=i*a+u*n,t[5]=o*a+c*n,t[6]=s*a+h*n,t[7]=l*a+f*n,t[8]=u*a-i*n,t[9]=c*a-o*n,t[10]=h*a-s*n,t[11]=f*a-l*n,t},oe.SIMD.rotateX=function(t,e,r){var n=SIMD.Float32x4.splat(Math.sin(r)),a=SIMD.Float32x4.splat(Math.cos(r));e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var i=SIMD.Float32x4.load(e,4),o=SIMD.Float32x4.load(e,8);return SIMD.Float32x4.store(t,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(i,a),SIMD.Float32x4.mul(o,n))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,a),SIMD.Float32x4.mul(i,n))),t},oe.rotateX=ne.USE_SIMD?oe.SIMD.rotateX:oe.scalar.rotateX,oe.scalar.rotateY=function(t,e,r){var n=Math.sin(r),a=Math.cos(r),i=e[0],o=e[1],s=e[2],l=e[3],u=e[8],c=e[9],h=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*a-u*n,t[1]=o*a-c*n,t[2]=s*a-h*n,t[3]=l*a-f*n,t[8]=i*n+u*a,t[9]=o*n+c*a,t[10]=s*n+h*a,t[11]=l*n+f*a,t},oe.SIMD.rotateY=function(t,e,r){var n=SIMD.Float32x4.splat(Math.sin(r)),a=SIMD.Float32x4.splat(Math.cos(r));e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var i=SIMD.Float32x4.load(e,0),o=SIMD.Float32x4.load(e,8);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,a),SIMD.Float32x4.mul(o,n))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(i,n),SIMD.Float32x4.mul(o,a))),t},oe.rotateY=ne.USE_SIMD?oe.SIMD.rotateY:oe.scalar.rotateY,oe.scalar.rotateZ=function(t,e,r){var n=Math.sin(r),a=Math.cos(r),i=e[0],o=e[1],s=e[2],l=e[3],u=e[4],c=e[5],h=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*a+u*n,t[1]=o*a+c*n,t[2]=s*a+h*n,t[3]=l*a+f*n,t[4]=u*a-i*n,t[5]=c*a-o*n,t[6]=h*a-s*n,t[7]=f*a-l*n,t},oe.SIMD.rotateZ=function(t,e,r){var n=SIMD.Float32x4.splat(Math.sin(r)),a=SIMD.Float32x4.splat(Math.cos(r));e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var i=SIMD.Float32x4.load(e,0),o=SIMD.Float32x4.load(e,4);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(i,a),SIMD.Float32x4.mul(o,n))),SIMD.Float32x4.store(t,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,a),SIMD.Float32x4.mul(i,n))),t},oe.rotateZ=ne.USE_SIMD?oe.SIMD.rotateZ:oe.scalar.rotateZ,oe.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},oe.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},oe.fromRotation=function(t,e,r){var n,a,i,o=r[0],s=r[1],l=r[2],u=Math.sqrt(o*o+s*s+l*l);return Math.abs(u)<ne.EPSILON?null:(u=1/u,o*=u,s*=u,l*=u,n=Math.sin(e),a=Math.cos(e),i=1-a,t[0]=o*o*i+a,t[1]=s*o*i+l*n,t[2]=l*o*i-s*n,t[3]=0,t[4]=o*s*i-l*n,t[5]=s*s*i+a,t[6]=l*s*i+o*n,t[7]=0,t[8]=o*l*i+s*n,t[9]=s*l*i-o*n,t[10]=l*l*i+a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},oe.fromXRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},oe.fromYRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},oe.fromZRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},oe.fromRotationTranslation=function(t,e,r){var n=e[0],a=e[1],i=e[2],o=e[3],s=n+n,l=a+a,u=i+i,c=n*s,h=n*l,f=n*u,d=a*l,m=a*u,p=i*u,g=o*s,M=o*l,b=o*u;return t[0]=1-(d+p),t[1]=h+b,t[2]=f-M,t[3]=0,t[4]=h-b,t[5]=1-(c+p),t[6]=m+g,t[7]=0,t[8]=f+M,t[9]=m-g,t[10]=1-(c+d),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},oe.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},oe.getRotation=function(t,e){var r=e[0]+e[5]+e[10],n=0;return r>0?(n=2*Math.sqrt(r+1),t[3]=.25*n,t[0]=(e[6]-e[9])/n,t[1]=(e[8]-e[2])/n,t[2]=(e[1]-e[4])/n):e[0]>e[5]&e[0]>e[10]?(n=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/n,t[0]=.25*n,t[1]=(e[1]+e[4])/n,t[2]=(e[8]+e[2])/n):e[5]>e[10]?(n=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/n,t[0]=(e[1]+e[4])/n,t[1]=.25*n,t[2]=(e[6]+e[9])/n):(n=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/n,t[0]=(e[8]+e[2])/n,t[1]=(e[6]+e[9])/n,t[2]=.25*n),t},oe.fromRotationTranslationScale=function(t,e,r,n){var a=e[0],i=e[1],o=e[2],s=e[3],l=a+a,u=i+i,c=o+o,h=a*l,f=a*u,d=a*c,m=i*u,p=i*c,g=o*c,M=s*l,b=s*u,x=s*c,v=n[0],y=n[1],S=n[2];return t[0]=(1-(m+g))*v,t[1]=(f+x)*v,t[2]=(d-b)*v,t[3]=0,t[4]=(f-x)*y,t[5]=(1-(h+g))*y,t[6]=(p+M)*y,t[7]=0,t[8]=(d+b)*S,t[9]=(p-M)*S,t[10]=(1-(h+m))*S,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},oe.fromRotationTranslationScaleOrigin=function(t,e,r,n,a){var i=e[0],o=e[1],s=e[2],l=e[3],u=i+i,c=o+o,h=s+s,f=i*u,d=i*c,m=i*h,p=o*c,g=o*h,M=s*h,b=l*u,x=l*c,v=l*h,y=n[0],S=n[1],I=n[2],A=a[0],D=a[1],F=a[2];return t[0]=(1-(p+M))*y,t[1]=(d+v)*y,t[2]=(m-x)*y,t[3]=0,t[4]=(d-v)*S,t[5]=(1-(f+M))*S,t[6]=(g+b)*S,t[7]=0,t[8]=(m+x)*I,t[9]=(g-b)*I,t[10]=(1-(f+p))*I,t[11]=0,t[12]=r[0]+A-(t[0]*A+t[4]*D+t[8]*F),t[13]=r[1]+D-(t[1]*A+t[5]*D+t[9]*F),t[14]=r[2]+F-(t[2]*A+t[6]*D+t[10]*F),t[15]=1,t},oe.fromQuat=function(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],o=r+r,s=n+n,l=a+a,u=r*o,c=n*o,h=n*s,f=a*o,d=a*s,m=a*l,p=i*o,g=i*s,M=i*l;return t[0]=1-h-m,t[1]=c+M,t[2]=f-g,t[3]=0,t[4]=c-M,t[5]=1-u-m,t[6]=d+p,t[7]=0,t[8]=f+g,t[9]=d-p,t[10]=1-u-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},oe.frustum=function(t,e,r,n,a,i,o){var s=1/(r-e),l=1/(a-n),u=1/(i-o);return t[0]=2*i*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*i*l,t[6]=0,t[7]=0,t[8]=(r+e)*s,t[9]=(a+n)*l,t[10]=(o+i)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*i*2*u,t[15]=0,t},oe.perspective=function(t,e,r,n,a){var i=1/Math.tan(e/2),o=1/(n-a);return t[0]=i/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(a+n)*o,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*a*n*o,t[15]=0,t},oe.perspectiveFromFieldOfView=function(t,e,r,n){var a=Math.tan(e.upDegrees*Math.PI/180),i=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+s),u=2/(a+i);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-(o-s)*l*.5,t[9]=(a-i)*u*.5,t[10]=n/(r-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*r/(r-n),t[15]=0,t},oe.ortho=function(t,e,r,n,a,i,o){var s=1/(e-r),l=1/(n-a),u=1/(i-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+r)*s,t[13]=(a+n)*l,t[14]=(o+i)*u,t[15]=1,t},oe.lookAt=function(t,e,r,n){var a,i,o,s,l,u,c,h,f,d,m=e[0],p=e[1],g=e[2],M=n[0],b=n[1],x=n[2],v=r[0],y=r[1],S=r[2];return Math.abs(m-v)<ne.EPSILON&&Math.abs(p-y)<ne.EPSILON&&Math.abs(g-S)<ne.EPSILON?oe.identity(t):(c=m-v,h=p-y,f=g-S,d=1/Math.sqrt(c*c+h*h+f*f),c*=d,h*=d,f*=d,a=b*f-x*h,i=x*c-M*f,o=M*h-b*c,(d=Math.sqrt(a*a+i*i+o*o))?(a*=d=1/d,i*=d,o*=d):(a=0,i=0,o=0),s=h*o-f*i,l=f*a-c*o,u=c*i-h*a,(d=Math.sqrt(s*s+l*l+u*u))?(s*=d=1/d,l*=d,u*=d):(s=0,l=0,u=0),t[0]=a,t[1]=s,t[2]=c,t[3]=0,t[4]=i,t[5]=l,t[6]=h,t[7]=0,t[8]=o,t[9]=u,t[10]=f,t[11]=0,t[12]=-(a*m+i*p+o*g),t[13]=-(s*m+l*p+u*g),t[14]=-(c*m+h*p+f*g),t[15]=1,t)},oe.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},oe.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},oe.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t},oe.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t},oe.sub=oe.subtract,oe.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t},oe.multiplyScalarAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t[9]=e[9]+r[9]*n,t[10]=e[10]+r[10]*n,t[11]=e[11]+r[11]*n,t[12]=e[12]+r[12]*n,t[13]=e[13]+r[13]*n,t[14]=e[14]+r[14]*n,t[15]=e[15]+r[15]*n,t},oe.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},oe.equals=function(t,e){var r=t[0],n=t[1],a=t[2],i=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8],h=t[9],f=t[10],d=t[11],m=t[12],p=t[13],g=t[14],M=t[15],b=e[0],x=e[1],v=e[2],y=e[3],S=e[4],I=e[5],A=e[6],D=e[7],F=e[8],E=e[9],w=e[10],T=e[11],_=e[12],L=e[13],O=e[14],R=e[15];return Math.abs(r-b)<=ne.EPSILON*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(n-x)<=ne.EPSILON*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(a-v)<=ne.EPSILON*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(i-y)<=ne.EPSILON*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(o-S)<=ne.EPSILON*Math.max(1,Math.abs(o),Math.abs(S))&&Math.abs(s-I)<=ne.EPSILON*Math.max(1,Math.abs(s),Math.abs(I))&&Math.abs(l-A)<=ne.EPSILON*Math.max(1,Math.abs(l),Math.abs(A))&&Math.abs(u-D)<=ne.EPSILON*Math.max(1,Math.abs(u),Math.abs(D))&&Math.abs(c-F)<=ne.EPSILON*Math.max(1,Math.abs(c),Math.abs(F))&&Math.abs(h-E)<=ne.EPSILON*Math.max(1,Math.abs(h),Math.abs(E))&&Math.abs(f-w)<=ne.EPSILON*Math.max(1,Math.abs(f),Math.abs(w))&&Math.abs(d-T)<=ne.EPSILON*Math.max(1,Math.abs(d),Math.abs(T))&&Math.abs(m-_)<=ne.EPSILON*Math.max(1,Math.abs(m),Math.abs(_))&&Math.abs(p-L)<=ne.EPSILON*Math.max(1,Math.abs(p),Math.abs(L))&&Math.abs(g-O)<=ne.EPSILON*Math.max(1,Math.abs(g),Math.abs(O))&&Math.abs(M-R)<=ne.EPSILON*Math.max(1,Math.abs(M),Math.abs(R))};var se=oe,le={};le.create=function(){var t=new ne.ARRAY_TYPE(3);return t[0]=0,t[1]=0,t[2]=0,t},le.clone=function(t){var e=new ne.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},le.fromValues=function(t,e,r){var n=new ne.ARRAY_TYPE(3);return n[0]=t,n[1]=e,n[2]=r,n},le.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},le.set=function(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t},le.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},le.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t},le.sub=le.subtract,le.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t},le.mul=le.multiply,le.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t},le.div=le.divide,le.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},le.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},le.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t},le.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t},le.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},le.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},le.scaleAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t},le.distance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],a=e[2]-t[2];return Math.sqrt(r*r+n*n+a*a)},le.dist=le.distance,le.squaredDistance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],a=e[2]-t[2];return r*r+n*n+a*a},le.sqrDist=le.squaredDistance,le.length=function(t){var e=t[0],r=t[1],n=t[2];return Math.sqrt(e*e+r*r+n*n)},le.len=le.length,le.squaredLength=function(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n},le.sqrLen=le.squaredLength,le.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},le.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},le.normalize=function(t,e){var r=e[0],n=e[1],a=e[2],i=r*r+n*n+a*a;return i>0&&(i=1/Math.sqrt(i),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i),t},le.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},le.cross=function(t,e,r){var n=e[0],a=e[1],i=e[2],o=r[0],s=r[1],l=r[2];return t[0]=a*l-i*s,t[1]=i*o-n*l,t[2]=n*s-a*o,t},le.lerp=function(t,e,r,n){var a=e[0],i=e[1],o=e[2];return t[0]=a+n*(r[0]-a),t[1]=i+n*(r[1]-i),t[2]=o+n*(r[2]-o),t},le.hermite=function(t,e,r,n,a,i){var o=i*i,s=o*(2*i-3)+1,l=o*(i-2)+i,u=o*(i-1),c=o*(3-2*i);return t[0]=e[0]*s+r[0]*l+n[0]*u+a[0]*c,t[1]=e[1]*s+r[1]*l+n[1]*u+a[1]*c,t[2]=e[2]*s+r[2]*l+n[2]*u+a[2]*c,t},le.bezier=function(t,e,r,n,a,i){var o=1-i,s=o*o,l=i*i,u=s*o,c=3*i*s,h=3*l*o,f=l*i;return t[0]=e[0]*u+r[0]*c+n[0]*h+a[0]*f,t[1]=e[1]*u+r[1]*c+n[1]*h+a[1]*f,t[2]=e[2]*u+r[2]*c+n[2]*h+a[2]*f,t},le.random=function(t,e){e=e||1;var r=2*ne.RANDOM()*Math.PI,n=2*ne.RANDOM()-1,a=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(r)*a,t[1]=Math.sin(r)*a,t[2]=n*e,t},le.transformMat4=function(t,e,r){var n=e[0],a=e[1],i=e[2],o=r[3]*n+r[7]*a+r[11]*i+r[15];return o=o||1,t[0]=(r[0]*n+r[4]*a+r[8]*i+r[12])/o,t[1]=(r[1]*n+r[5]*a+r[9]*i+r[13])/o,t[2]=(r[2]*n+r[6]*a+r[10]*i+r[14])/o,t},le.transformMat3=function(t,e,r){var n=e[0],a=e[1],i=e[2];return t[0]=n*r[0]+a*r[3]+i*r[6],t[1]=n*r[1]+a*r[4]+i*r[7],t[2]=n*r[2]+a*r[5]+i*r[8],t},le.transformQuat=function(t,e,r){var n=e[0],a=e[1],i=e[2],o=r[0],s=r[1],l=r[2],u=r[3],c=u*n+s*i-l*a,h=u*a+l*n-o*i,f=u*i+o*a-s*n,d=-o*n-s*a-l*i;return t[0]=c*u+d*-o+h*-l-f*-s,t[1]=h*u+d*-s+f*-o-c*-l,t[2]=f*u+d*-l+c*-s-h*-o,t},le.rotateX=function(t,e,r,n){var a=[],i=[];return a[0]=e[0]-r[0],a[1]=e[1]-r[1],a[2]=e[2]-r[2],i[0]=a[0],i[1]=a[1]*Math.cos(n)-a[2]*Math.sin(n),i[2]=a[1]*Math.sin(n)+a[2]*Math.cos(n),t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t},le.rotateY=function(t,e,r,n){var a=[],i=[];return a[0]=e[0]-r[0],a[1]=e[1]-r[1],a[2]=e[2]-r[2],i[0]=a[2]*Math.sin(n)+a[0]*Math.cos(n),i[1]=a[1],i[2]=a[2]*Math.cos(n)-a[0]*Math.sin(n),t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t},le.rotateZ=function(t,e,r,n){var a=[],i=[];return a[0]=e[0]-r[0],a[1]=e[1]-r[1],a[2]=e[2]-r[2],i[0]=a[0]*Math.cos(n)-a[1]*Math.sin(n),i[1]=a[0]*Math.sin(n)+a[1]*Math.cos(n),i[2]=a[2],t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t},le.forEach=function(){var t=le.create();return function(e,r,n,a,i,o){var s,l;for(r||(r=3),n||(n=0),l=a?Math.min(a*r+n,e.length):e.length,s=n;s<l;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],i(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}}(),le.angle=function(t,e){var r=le.fromValues(t[0],t[1],t[2]),n=le.fromValues(e[0],e[1],e[2]);le.normalize(r,r),le.normalize(n,n);var a=le.dot(r,n);return a>1?0:Math.acos(a)},le.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},le.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},le.equals=function(t,e){var r=t[0],n=t[1],a=t[2],i=e[0],o=e[1],s=e[2];return Math.abs(r-i)<=ne.EPSILON*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-o)<=ne.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(a-s)<=ne.EPSILON*Math.max(1,Math.abs(a),Math.abs(s))};var ue=le,ce={};ce.create=function(){var t=new ne.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},ce.clone=function(t){var e=new ne.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},ce.fromValues=function(t,e,r,n){var a=new ne.ARRAY_TYPE(4);return a[0]=t,a[1]=e,a[2]=r,a[3]=n,a},ce.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},ce.set=function(t,e,r,n,a){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t},ce.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},ce.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t},ce.sub=ce.subtract,ce.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t},ce.mul=ce.multiply,ce.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t},ce.div=ce.divide,ce.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},ce.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},ce.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t},ce.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t},ce.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},ce.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},ce.scaleAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t},ce.distance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],a=e[2]-t[2],i=e[3]-t[3];return Math.sqrt(r*r+n*n+a*a+i*i)},ce.dist=ce.distance,ce.squaredDistance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],a=e[2]-t[2],i=e[3]-t[3];return r*r+n*n+a*a+i*i},ce.sqrDist=ce.squaredDistance,ce.length=function(t){var e=t[0],r=t[1],n=t[2],a=t[3];return Math.sqrt(e*e+r*r+n*n+a*a)},ce.len=ce.length,ce.squaredLength=function(t){var e=t[0],r=t[1],n=t[2],a=t[3];return e*e+r*r+n*n+a*a},ce.sqrLen=ce.squaredLength,ce.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},ce.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},ce.normalize=function(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],o=r*r+n*n+a*a+i*i;return o>0&&(o=1/Math.sqrt(o),t[0]=r*o,t[1]=n*o,t[2]=a*o,t[3]=i*o),t},ce.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},ce.lerp=function(t,e,r,n){var a=e[0],i=e[1],o=e[2],s=e[3];return t[0]=a+n*(r[0]-a),t[1]=i+n*(r[1]-i),t[2]=o+n*(r[2]-o),t[3]=s+n*(r[3]-s),t},ce.random=function(t,e){return e=e||1,t[0]=ne.RANDOM(),t[1]=ne.RANDOM(),t[2]=ne.RANDOM(),t[3]=ne.RANDOM(),ce.normalize(t,t),ce.scale(t,t,e),t},ce.transformMat4=function(t,e,r){var n=e[0],a=e[1],i=e[2],o=e[3];return t[0]=r[0]*n+r[4]*a+r[8]*i+r[12]*o,t[1]=r[1]*n+r[5]*a+r[9]*i+r[13]*o,t[2]=r[2]*n+r[6]*a+r[10]*i+r[14]*o,t[3]=r[3]*n+r[7]*a+r[11]*i+r[15]*o,t},ce.transformQuat=function(t,e,r){var n=e[0],a=e[1],i=e[2],o=r[0],s=r[1],l=r[2],u=r[3],c=u*n+s*i-l*a,h=u*a+l*n-o*i,f=u*i+o*a-s*n,d=-o*n-s*a-l*i;return t[0]=c*u+d*-o+h*-l-f*-s,t[1]=h*u+d*-s+f*-o-c*-l,t[2]=f*u+d*-l+c*-s-h*-o,t[3]=e[3],t},ce.forEach=function(){var t=ce.create();return function(e,r,n,a,i,o){var s,l;for(r||(r=4),n||(n=0),l=a?Math.min(a*r+n,e.length):e.length,s=n;s<l;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],i(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}(),ce.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},ce.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},ce.equals=function(t,e){var r=t[0],n=t[1],a=t[2],i=t[3],o=e[0],s=e[1],l=e[2],u=e[3];return Math.abs(r-o)<=ne.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-s)<=ne.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(a-l)<=ne.EPSILON*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(i-u)<=ne.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))};var he=ce,fe={};fe.create=function(){var t=new ne.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},fe.rotationTo=function(){var t=ue.create(),e=ue.fromValues(1,0,0),r=ue.fromValues(0,1,0);return function(n,a,i){var o=ue.dot(a,i);return o<-.999999?(ue.cross(t,e,a),ue.length(t)<1e-6&&ue.cross(t,r,a),ue.normalize(t,t),fe.setAxisAngle(n,t,Math.PI),n):o>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(ue.cross(t,a,i),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+o,fe.normalize(n,n))}}(),fe.setAxes=function(){var t=ie.create();return function(e,r,n,a){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=a[0],t[4]=a[1],t[7]=a[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],fe.normalize(e,fe.fromMat3(e,t))}}(),fe.clone=he.clone,fe.fromValues=he.fromValues,fe.copy=he.copy,fe.set=he.set,fe.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},fe.setAxisAngle=function(t,e,r){r*=.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t},fe.getAxisAngle=function(t,e){var r=2*Math.acos(e[3]),n=Math.sin(r/2);return 0!=n?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),r},fe.add=he.add,fe.multiply=function(t,e,r){var n=e[0],a=e[1],i=e[2],o=e[3],s=r[0],l=r[1],u=r[2],c=r[3];return t[0]=n*c+o*s+a*u-i*l,t[1]=a*c+o*l+i*s-n*u,t[2]=i*c+o*u+n*l-a*s,t[3]=o*c-n*s-a*l-i*u,t},fe.mul=fe.multiply,fe.scale=he.scale,fe.rotateX=function(t,e,r){r*=.5;var n=e[0],a=e[1],i=e[2],o=e[3],s=Math.sin(r),l=Math.cos(r);return t[0]=n*l+o*s,t[1]=a*l+i*s,t[2]=i*l-a*s,t[3]=o*l-n*s,t},fe.rotateY=function(t,e,r){r*=.5;var n=e[0],a=e[1],i=e[2],o=e[3],s=Math.sin(r),l=Math.cos(r);return t[0]=n*l-i*s,t[1]=a*l+o*s,t[2]=i*l+n*s,t[3]=o*l-a*s,t},fe.rotateZ=function(t,e,r){r*=.5;var n=e[0],a=e[1],i=e[2],o=e[3],s=Math.sin(r),l=Math.cos(r);return t[0]=n*l+a*s,t[1]=a*l-n*s,t[2]=i*l+o*s,t[3]=o*l-i*s,t},fe.calculateW=function(t,e){var r=e[0],n=e[1],a=e[2];return t[0]=r,t[1]=n,t[2]=a,t[3]=Math.sqrt(Math.abs(1-r*r-n*n-a*a)),t},fe.dot=he.dot,fe.lerp=he.lerp,fe.slerp=function(t,e,r,n){var a,i,o,s,l,u=e[0],c=e[1],h=e[2],f=e[3],d=r[0],m=r[1],p=r[2],g=r[3];return(i=u*d+c*m+h*p+f*g)<0&&(i=-i,d=-d,m=-m,p=-p,g=-g),1-i>1e-6?(a=Math.acos(i),o=Math.sin(a),s=Math.sin((1-n)*a)/o,l=Math.sin(n*a)/o):(s=1-n,l=n),t[0]=s*u+l*d,t[1]=s*c+l*m,t[2]=s*h+l*p,t[3]=s*f+l*g,t},fe.sqlerp=function(){var t=fe.create(),e=fe.create();return function(r,n,a,i,o,s){return fe.slerp(t,n,o,s),fe.slerp(e,a,i,s),fe.slerp(r,t,e,2*s*(1-s)),r}}(),fe.invert=function(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],o=r*r+n*n+a*a+i*i,s=o?1/o:0;return t[0]=-r*s,t[1]=-n*s,t[2]=-a*s,t[3]=i*s,t},fe.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},fe.length=he.length,fe.len=fe.length,fe.squaredLength=he.squaredLength,fe.sqrLen=fe.squaredLength,fe.normalize=he.normalize,fe.fromMat3=function(t,e){var r,n=e[0]+e[4]+e[8];if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var a=0;e[4]>e[0]&&(a=1),e[8]>e[3*a+a]&&(a=2);var i=(a+1)%3,o=(a+2)%3;r=Math.sqrt(e[3*a+a]-e[3*i+i]-e[3*o+o]+1),t[a]=.5*r,r=.5/r,t[3]=(e[3*i+o]-e[3*o+i])*r,t[i]=(e[3*i+a]+e[3*a+i])*r,t[o]=(e[3*o+a]+e[3*a+o])*r}return t},fe.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},fe.exactEquals=he.exactEquals,fe.equals=he.equals;var de={};de.create=function(){var t=new ne.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},de.clone=function(t){var e=new ne.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},de.fromValues=function(t,e){var r=new ne.ARRAY_TYPE(2);return r[0]=t,r[1]=e,r},de.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},de.set=function(t,e,r){return t[0]=e,t[1]=r,t},de.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t},de.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t},de.sub=de.subtract,de.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t},de.mul=de.multiply,de.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t},de.div=de.divide,de.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},de.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},de.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t},de.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t},de.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},de.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t},de.scaleAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t},de.distance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(r*r+n*n)},de.dist=de.distance,de.squaredDistance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n},de.sqrDist=de.squaredDistance,de.length=function(t){var e=t[0],r=t[1];return Math.sqrt(e*e+r*r)},de.len=de.length,de.squaredLength=function(t){var e=t[0],r=t[1];return e*e+r*r},de.sqrLen=de.squaredLength,de.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},de.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},de.normalize=function(t,e){var r=e[0],n=e[1],a=r*r+n*n;return a>0&&(a=1/Math.sqrt(a),t[0]=e[0]*a,t[1]=e[1]*a),t},de.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},de.cross=function(t,e,r){var n=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=n,t},de.lerp=function(t,e,r,n){var a=e[0],i=e[1];return t[0]=a+n*(r[0]-a),t[1]=i+n*(r[1]-i),t},de.random=function(t,e){e=e||1;var r=2*ne.RANDOM()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t},de.transformMat2=function(t,e,r){var n=e[0],a=e[1];return t[0]=r[0]*n+r[2]*a,t[1]=r[1]*n+r[3]*a,t},de.transformMat2d=function(t,e,r){var n=e[0],a=e[1];return t[0]=r[0]*n+r[2]*a+r[4],t[1]=r[1]*n+r[3]*a+r[5],t},de.transformMat3=function(t,e,r){var n=e[0],a=e[1];return t[0]=r[0]*n+r[3]*a+r[6],t[1]=r[1]*n+r[4]*a+r[7],t},de.transformMat4=function(t,e,r){var n=e[0],a=e[1];return t[0]=r[0]*n+r[4]*a+r[12],t[1]=r[1]*n+r[5]*a+r[13],t},de.forEach=function(){var t=de.create();return function(e,r,n,a,i,o){var s,l;for(r||(r=2),n||(n=0),l=a?Math.min(a*r+n,e.length):e.length,s=n;s<l;s+=r)t[0]=e[s],t[1]=e[s+1],i(t,t,o),e[s]=t[0],e[s+1]=t[1];return e}}(),de.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},de.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},de.equals=function(t,e){var r=t[0],n=t[1],a=e[0],i=e[1];return Math.abs(r-a)<=ne.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-i)<=ne.EPSILON*Math.max(1,Math.abs(n),Math.abs(i))};var me=se;const pe=Math.PI/180;class ge{constructor(){this.mat4=me.create(),Object.freeze(this)}identity(){me.identity(this.mat4)}ortho(t,e){const r=t>>1,n=e>>1,a=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:Math.pow(2,16))>>1;me.ortho(this.mat4,-r,r,-n,n,-a,a)}translate(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;me.translate(this.mat4,this.mat4,[t,e,r])}scale(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;me.scale(this.mat4,this.mat4,[t,e,r])}rotateX(t){me.rotateX(this.mat4,this.mat4,t*pe)}rotateY(t){me.rotateY(this.mat4,this.mat4,t*pe)}rotateZ(t){me.rotateZ(this.mat4,this.mat4,t*pe)}multiply(t,e){me.multiply(this.mat4,t.mat4,e.mat4)}copy(t){me.copy(this.mat4,t.mat4)}clone(){const t=new ge;return t.copy(this),t}get x(){return this.mat4[12]}set x(t){this.mat4[12]=t}get y(){return this.mat4[13]}set y(t){this.mat4[13]=t}get z(){return this.mat4[14]}set z(t){this.mat4[14]=t}get sx(){return this.mat4[0]}set sx(t){this.mat4[0]=t}get sy(){return this.mat4[5]}set sy(t){this.mat4[5]=t}get sz(){return this.mat4[10]}set sz(t){this.mat4[10]=t}}class Me extends Ct{constructor(t,e){super(t,Ct.TYPE.UNIFORM,e)}}const be="viewMatrix";class xe{constructor(t){let e=t.desiredWidth,r=t.desiredHeight,n=t.pixelRatio,a=t.sizeFit,i=t.uniformName;this.desiredWidth=e,this.desiredHeight=r,this.pixelRatio=n,this.sizeFit=a,this.uniform=new Me(i||be,new ge),this.width=0,this.height=0}updateOrtho(t,e){t===this.width&&e===this.height||(this.width=t,this.height=e,this.uniform.value.ortho(t,e),this.uniform.touch())}update(t,e){if("fill"===this.sizeFit&&this.desiredWidth>0&&this.desiredHeight>0)this.updateOrtho(this.desiredWidth,this.desiredHeight);else if(("cover"===this.sizeFit||"contain"===this.sizeFit)&&this.desiredWidth>=0&&this.desiredHeight>=0){const r=e/t,n=this.desiredHeight/this.desiredWidth,a="cover"===this.sizeFit;let i=this.desiredWidth,o=this.desiredHeight;if(0===this.desiredWidth&&this.desiredHeight||r<n){if(i=this.desiredHeight/e*t,a){const t=this.desiredWidth/i;i*=t,o*=t}}else if((this.desiredWidth&&0===this.desiredHeight||r>n)&&(o=this.desiredWidth/t*e,a)){const t=this.desiredHeight/o;i*=t,o*=t}this.updateOrtho(i,o)}}}const ve="blitpunk-canvas",ye="blitpunk-scene",Se="blitpunk-texture-atlas",Ie="blitpunk-sprite-group",Ae=ve.toUpperCase(),De=ye.toUpperCase(),Fe=Se.toUpperCase(),Ee=Ie.toUpperCase(),we=1e3,Te=10;class _e{constructor(t,e){this.projection=new xe(e),t.on("*",we,this)}animateFrame(t){this.projection.update(t.width,t.height)}renderFrame(t){t.shaderContext.pushVar(this.projection.uniform)}debug(){console.dir(this.projection)}update(t){console.log("TODO ProjectionComponent.update(",t,")")}disconnectedEntity(t){console.log("ProjectionComponent.disconnectedEntity(",t,")"),t.off(this)}}class Le{constructor(t){et(this),t.on("*",Te,this)}appendChild(t){t.hasComponent("parentEntity")&&t.destroyComponent("parentEntity"),t.setComponent("parentEntity",this),this.on(t)}removeChild(t){this.off(t),t.destroyComponent("parentEntity")}disconnectedEntity(t){console.log("ProjectionComponent.disconnectedEntity(",t,")"),t.off(this)}}const Oe=t=>({create:(e,r)=>new t(e,te(r)),update(t,e){t.update(te(e))}});var Re=function(t){t.registerComponent("projection",Oe(_e)),t.registerComponent("children",Oe(Le))};const Pe=()=>window.performance.now()/1e3,Ce=(t,e,r)=>t&&e in t?t[e]:"function"==typeof r?r():r;class ze{constructor(t){et(this);const e=Ce.bind(null,t);this.componentRegistry=e("componentRegistry",()=>new at),this.entityManager=e("entityManager",()=>new lt),this.resourceLibrary=e("resourceLibrary",()=>new wt),this.textureLibrary=e("textureLibrary",()=>new Nt),this.canvas=e("canvas",()=>document.createElement("canvas")),this.contextAttributes={alpha:e("alpha",!1),depth:e("depth",!1),stencil:e("stencil",!1),antialias:e("antialias",!1),premultipliedAlpha:e("premultipliedAlpha",!1),preserveDrawingBuffer:e("preserveDrawingBuffer",!1)},this.time=e("time",0),this.frameNo=e("frameNo",0),this.clearColor=e("clearColor"),this.createGlContext=e("createGlContext",()=>()=>N(this.canvas,this.contextAttributes)),Re(this.componentRegistry),this.entity=this.entityManager.createEntity(),this.entity.setComponent("blitpunk",this),this.entity.setComponent("resourceLibrary",this.resourceLibrary),this.entity.setComponent("textureLibrary",this.textureLibrary),this.componentRegistry.createComponent(this.entity,"children")}get clearColor(){return this.renderer?this.renderer.clearColor:this._clearColor}set clearColor(t){this._clearColor=null==t?t:nt(t),this.renderer&&this.renderer.setClearColor(this._clearColor)}start(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;this.el=t,this.glx=new Xt(this.createGlContext()),this.renderer=new Qt(this.glx),this._clearColor&&this.renderer.setClearColor(this._clearColor),this.startTime=Pe(),this.el.appendChild(this.canvas),this.resize(),this.requestAnimate()}destroy(){window.cancelAnimationFrame(this.rafSubscription)}requestAnimate(){this.rafSubscription=window.requestAnimationFrame(()=>this.animate())}animate(){this.renderFrame(),this.requestAnimate()}renderFrame(){++this.frameNo,this.time=Pe()-this.startTime,this.resize(),this.renderer.renderFrame(this.entity,this)}resize(){const t="inline"===window.getComputedStyle(this.el,null).display?this.el.parentNode:this.el,e=this.canvas,r=window.devicePixelRatio||1;let n=t.clientWidth,a=t.clientHeight;e.style.width=n+"px",e.style.height=a+"px";const i=Math.round(n*r),o=Math.round(a*r);i===e.width&&o===e.height||(e.width=i,e.height=o),i===this.width&&o===this.height||(this.width=i,this.height=o,this.glx.gl.viewport(0,0,i,o))}}class Ne extends HTMLElement{constructor(t){const e=super(t);return et(e),e.blitpunk=new ze,e.blitpunk.entity.on(e),e}get blitpunkNodeName(){return Ae}get canvas(){return this.blitpunk.canvas}get width(){return this.blitpunk.width}get height(){return this.blitpunk.height}get glx(){return this.blitpunk.glx}get renderer(){return this.blitpunk.renderer}get time(){return this.blitpunk.time}get startTime(){return this.blitpunk.startTime}get frameNo(){return this.blitpunk.frameNo}get componentRegistry(){return this.blitpunk.componentRegistry}get entityManager(){return this.blitpunk.entityManager}get resourceLibrary(){return this.blitpunk.resourceLibrary}get textureLibrary(){return this.blitpunk.textureLibrary}get scene(){return this.blitpunk.entity}static get observedAttributes(){return["clear-color","projection"]}onKeydown(t){t.ctrlKey&&"d"===t.key&&(console.group("<blitpunk/>","frame",this.frameNo),console.log(this),console.log(this.blitpunk),this.blitpunk.entity.emit("debug",this),this.renderer.emit("debug",this.renderer),console.groupEnd())}set clearColor(t){this.blitpunk.clearColor=t}get clearColor(){const t=this.blitpunk.clearColor;if(t)return 1===t.getAlpha()?t.toHexString():t.toRgbString()}connectedCallback(){this.blitpunk.contextAttributes=Object.freeze({alpha:this.hasAttribute("alpha"),depth:this.hasAttribute("depth"),stencil:this.hasAttribute("stencil"),antialias:this.hasAttribute("antialias"),premultipliedAlpha:this.hasAttribute("premultipliedAlpha"),preserveDrawingBuffer:this.hasAttribute("preserveDrawingBuffer")}),this.onKeydown=this.onKeydown.bind(this),document.body.addEventListener("keydown",this.onKeydown),this.blitpunk.start(this)}disconnectedCallback(){this.blitpunk.destroy(),document.body.removeEventListener("keydown",this.onKeydown)}attributeChangedCallback(t,e,r){switch(t){case"clear-color":this.clearColor=r;break;case"projection":this.blitpunk.componentRegistry.createOrUpdateComponent(this.blitpunk.entity,"projection",r)}}}const He=["BODY","HTML"];class ke extends HTMLElement{constructor(t){const e=super(t);return et(e)}get blitpunkNodeName(){return De}get blitpunk(){return this.blitpunkCanvas.blitpunk}connectedCallback(){this.blitpunkCanvas=H(this,Ae)}disconnectedCallback(){this.blitpunkCanvas=null}}var Ve=function(t){return H(t,Ae)};const Ue=["BODY","HTML"];var je=function(t){t.blitpunkCanvas=Ve(t),t.blitpunk=t.blitpunkCanvas.blitpunk,t.entityManager=t.blitpunk.entityManager,t.entity=t.entityManager.createEntity(),t.entity.on(t),t.parentSceneElement=k(t,"scene"),t.parentScene=t.parentSceneElement.scene,t.parentScene.children.appendChild(t.entity)},qe=function(t){t.parentScene.children.removeChild(t.entity),t.parentScene=null,t.parentSceneElement=null,t.entity.off(t),t.entityManager.destroyEntity(t.entity),t.entity=null,t.blitpunk=null,t.blitpunkCanvas=null};class Be extends HTMLElement{static get observedAttributes(){return["src"]}constructor(t){const e=super(t);return et(e)}get blitpunkNodeName(){return Fe}get textureId(){return this.entity&&this.entity.id}loadTextureAtlas(t){if(t&&this.entity&&this.prevUrl!==t)return this.prevUrl=t,this.textureAtlasPromise=this.textureLibrary.loadTextureAtlas(this.textureId,t).then(t=>(this.textureAtlas=t,t)),this.textureAtlasPromise}debug(){console.log(this.textureAtlas)}connectedCallback(){je(this),this.textureLibrary=this.parentSceneElement.textureLibrary,this.loadTextureAtlas(this.getAttribute("src"))}disconnectedCallback(){this.textureAtlas=null,this.textureLibrary=null,qe(this)}attributeChangedCallback(t,e,r){"src"===t&&this.loadTextureAtlas(r)}}var Ye=Array.isArray,Ge="object"==typeof rt&&rt&&rt.Object===Object&&rt,$e="object"==typeof self&&self&&self.Object===Object&&self,Xe=Ge||$e||Function("return this")(),We=Xe.Symbol,Ze=Object.prototype,Ke=Ze.hasOwnProperty,Qe=Ze.toString,Je=We?We.toStringTag:void 0,tr=function(t){var e=Ke.call(t,Je),r=t[Je];try{t[Je]=void 0;var n=!0}catch(t){}var a=Qe.call(t);return n&&(e?t[Je]=r:delete t[Je]),a},er=Object.prototype.toString,rr=function(t){return er.call(t)},nr="[object Null]",ar="[object Undefined]",ir=We?We.toStringTag:void 0,or=function(t){return null==t?void 0===t?ar:nr:ir&&ir in Object(t)?tr(t):rr(t)},sr=function(t){return null!=t&&"object"==typeof t},lr="[object Symbol]",ur=function(t){return"symbol"==typeof t||sr(t)&&or(t)==lr},cr=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,hr=/^\w*$/,fr=function(t,e){if(Ye(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!ur(t))||hr.test(t)||!cr.test(t)||null!=e&&t in Object(e)},dr=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},mr="[object AsyncFunction]",pr="[object Function]",gr="[object GeneratorFunction]",Mr="[object Proxy]",br=function(t){if(!dr(t))return!1;var e=or(t);return e==pr||e==gr||e==mr||e==Mr},xr=Xe["__core-js_shared__"],vr=function(){var t=/[^.]+$/.exec(xr&&xr.keys&&xr.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),yr=function(t){return!!vr&&vr in t},Sr=Function.prototype.toString,Ir=function(t){if(null!=t){try{return Sr.call(t)}catch(t){}try{return t+""}catch(t){}}return""},Ar=/[\\^$.*+?()[\]{}|]/g,Dr=/^\[object .+?Constructor\]$/,Fr=Function.prototype,Er=Object.prototype,wr=Fr.toString,Tr=Er.hasOwnProperty,_r=RegExp("^"+wr.call(Tr).replace(Ar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Lr=function(t){return!(!dr(t)||yr(t))&&(br(t)?_r:Dr).test(Ir(t))},Or=function(t,e){return null==t?void 0:t[e]},Rr=function(t,e){var r=Or(t,e);return Lr(r)?r:void 0},Pr=Rr(Object,"create"),Cr="__lodash_hash_undefined__",zr=Object.prototype.hasOwnProperty,Nr=Object.prototype.hasOwnProperty,Hr="__lodash_hash_undefined__";V.prototype.clear=function(){this.__data__=Pr?Pr(null):{},this.size=0},V.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},V.prototype.get=function(t){var e=this.__data__;if(Pr){var r=e[t];return r===Cr?void 0:r}return zr.call(e,t)?e[t]:void 0},V.prototype.has=function(t){var e=this.__data__;return Pr?void 0!==e[t]:Nr.call(e,t)},V.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=Pr&&void 0===e?Hr:e,this};var kr=V,Vr=function(t,e){return t===e||t!==t&&e!==e},Ur=function(t,e){for(var r=t.length;r--;)if(Vr(t[r][0],e))return r;return-1},jr=Array.prototype.splice;U.prototype.clear=function(){this.__data__=[],this.size=0},U.prototype.delete=function(t){var e=this.__data__,r=Ur(e,t);return!(r<0||(r==e.length-1?e.pop():jr.call(e,r,1),--this.size,0))},U.prototype.get=function(t){var e=this.__data__,r=Ur(e,t);return r<0?void 0:e[r][1]},U.prototype.has=function(t){return Ur(this.__data__,t)>-1},U.prototype.set=function(t,e){var r=this.__data__,n=Ur(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};var qr=U,Br=Rr(Xe,"Map"),Yr=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t},Gr=function(t,e){var r=t.__data__;return Yr(e)?r["string"==typeof e?"string":"hash"]:r.map};j.prototype.clear=function(){this.size=0,this.__data__={hash:new kr,map:new(Br||qr),string:new kr}},j.prototype.delete=function(t){var e=Gr(this,t).delete(t);return this.size-=e?1:0,e},j.prototype.get=function(t){return Gr(this,t).get(t)},j.prototype.has=function(t){return Gr(this,t).has(t)},j.prototype.set=function(t,e){var r=Gr(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};var $r=j,Xr="Expected a function";q.Cache=$r;var Wr=q,Zr=500,Kr=/^\./,Qr=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Jr=/\\(\\)?/g,tn=function(t){var e=Wr(t,function(t){return r.size===Zr&&r.clear(),t}),r=e.cache;return e}(function(t){var e=[];return Kr.test(t)&&e.push(""),t.replace(Qr,function(t,r,n,a){e.push(n?a.replace(Jr,"$1"):r||t)}),e}),en=function(t,e){for(var r=-1,n=null==t?0:t.length,a=Array(n);++r<n;)a[r]=e(t[r],r,t);return a},rn=1/0,nn=We?We.prototype:void 0,an=nn?nn.toString:void 0,on=B,sn=function(t){return null==t?"":on(t)},ln=function(t,e){return Ye(t)?t:fr(t,e)?[t]:tn(sn(t))},un=1/0,cn=function(t){if("string"==typeof t||ur(t))return t;var e=t+"";return"0"==e&&1/t==-un?"-0":e},hn=function(t,e){for(var r=0,n=(e=ln(e,t)).length;null!=t&&r<n;)t=t[cn(e[r++])];return r&&r==n?t:void 0},fn=function(){try{var t=Rr(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),dn=function(t,e,r){"__proto__"==e&&fn?fn(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r},mn=Object.prototype.hasOwnProperty,pn=function(t,e,r){var n=t[e];mn.call(t,e)&&Vr(n,r)&&(void 0!==r||e in t)||dn(t,e,r)},gn=9007199254740991,Mn=/^(?:0|[1-9]\d*)$/,bn=function(t,e){return!!(e=null==e?gn:e)&&("number"==typeof t||Mn.test(t))&&t>-1&&t%1==0&&t<e},xn=function(t,e,r,n){if(!dr(t))return t;for(var a=-1,i=(e=ln(e,t)).length,o=i-1,s=t;null!=s&&++a<i;){var l=cn(e[a]),u=r;if(a!=o){var c=s[l];void 0===(u=n?n(c,l,s):void 0)&&(u=dr(c)?c:bn(e[a+1])?[]:{})}pn(s,l,u),s=s[l]}return t},vn=function(t,e,r){for(var n=-1,a=e.length,i={};++n<a;){var o=e[n],s=hn(t,o);r(s,o)&&xn(i,ln(o,t),s)}return i},yn=function(t,e){return null!=t&&e in Object(t)},Sn="[object Arguments]",In=function(t){return sr(t)&&or(t)==Sn},An=Object.prototype,Dn=An.hasOwnProperty,Fn=An.propertyIsEnumerable,En=In(function(){return arguments}())?In:function(t){return sr(t)&&Dn.call(t,"callee")&&!Fn.call(t,"callee")},wn=9007199254740991,Tn=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=wn},_n=function(t,e,r){for(var n=-1,a=(e=ln(e,t)).length,i=!1;++n<a;){var o=cn(e[n]);if(!(i=null!=t&&r(t,o)))break;t=t[o]}return i||++n!=a?i:!!(a=null==t?0:t.length)&&Tn(a)&&bn(o,a)&&(Ye(t)||En(t))},Ln=function(t,e){return null!=t&&_n(t,e,yn)},On=function(t,e){return vn(t,e,function(e,r){return Ln(t,r)})},Rn=function(t,e){for(var r=-1,n=e.length,a=t.length;++r<n;)t[a+r]=e[r];return t},Pn=We?We.isConcatSpreadable:void 0,Cn=function(t){return Ye(t)||En(t)||!!(Pn&&t&&t[Pn])},zn=Y,Nn=function(t){return(null==t?0:t.length)?zn(t,1):[]},Hn=function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)},kn=Math.max,Vn=function(t,e,r){return e=kn(void 0===e?t.length-1:e,0),function(){for(var n=arguments,a=-1,i=kn(n.length-e,0),o=Array(i);++a<i;)o[a]=n[e+a];a=-1;for(var s=Array(e+1);++a<e;)s[a]=n[a];return s[e]=r(o),Hn(t,this,s)}},Un=function(t){return function(){return t}},jn=fn?function(t,e){return fn(t,"toString",{configurable:!0,enumerable:!1,value:Un(e),writable:!0})}:function(t){return t},qn=800,Bn=16,Yn=Date.now,Gn=function(t){var e=0,r=0;return function(){var n=Yn(),a=Bn-(n-r);if(r=n,a>0){if(++e>=qn)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}(jn),$n=function(t){return Gn(Vn(t,void 0,Nn),t+"")}(function(t,e){return null==t?{}:On(t,e)});class Xn{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.resourceRef=new ct(this,{target:qt.ELEMENT_ARRAY_BUFFER,usage:"static"}),this.objectCount=t,this.itemCount=e,this.length=t*e,this.array=new Uint16Array(this.length),this.resourceRef.hints.typedArray=this.array}static Generate(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const a=new Xn(t,e.length);for(let i=0;i<t;++i)for(let t=0;t<e.length;++t)a.array[i*a.itemCount+t]=e[t]+(i+n)*r;return a}}class Wn{constructor(t,e){this.id=it(),this.vertexShader=t,this.fragmentShader=e}}class Zn{constructor(t,e){this.shaderLibrary=t,this.waitFor=Object.keys(e).map(t=>({shaderVarKey:t,textureId:e[t],isLoaded:!1})),this.shaderVarGroup=new Wt([]),this.shaderVarStore=new Map}get isLoaded(){return 0===this.waitFor.length&&this.shaderVarGroup.shaderVars.length>0}whenLoaded(t){this.isLoaded?t(this.shaderVarGroup):(this.waitFor.forEach(t=>{if(!t.isLoaded){const e=this.shaderLibrary.states.get(t.textureId);if(void 0===e||!e.isReady)return;const r=new zt(t.shaderVarKey);r.texture=e.texture,this.shaderVarGroup.shaderVars.push(r),t.isLoaded=!0}}),this.waitFor=this.waitFor.filter(t=>!1===t.isLoaded),this.isLoaded&&t(this.shaderVarGroup))}}class Kn extends Ct{constructor(t,e){super(t,Ct.TYPE.ATTRIB,e)}}class Qn{constructor(t,e,r){this.name=t,this.descriptor=e,this.bufferSource=r}get attrDescriptor(){return this.descriptor.attr[this.name]}get resourceRef(){const t=this.bufferSource;return t instanceof pt?t.resourceRef:t.voArray.resourceRef}}class Jn{constructor(t,e){this.name=t,this.shaderVar=e}get type(){return this.shaderVar.type}get value(){return this.shaderVar.value}get serial(){return this.shaderVar.serial}}class ta extends Wt{constructor(t){super([]);const e=t.descriptor;let r;Object.keys(e.attr).forEach(n=>{r?this.shaderVars.push(new Jn(n,r)):(r=new Kn(n,new Qn(n,e,t)),this.shaderVars.push(r))})}get bufferSource(){return this.shaderVars[0].value.bufferSource}get serial(){return this.shaderVars[0].serial}touch(){return this.shaderVars[0].touch()}}var ea=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const r=t.capacity-t.usedCount-t.allocatedCount,n=t.allocatedCount+(e>0&&e<r?e:r);for(let e=t.allocatedCount;e<n;e++){let r=t.voArray.subarray(e),n=t.descriptor.createVO(r);n.free=t.free.bind(t,n),t.availableVOs.push(n)}};class ra{constructor(t,e){this.id=it(),this.descriptor=t,this.capacity=e&&e.capacity||this.descriptor.maxIndexedVOPoolSize,this.maxAllocVOSize=e&&e.maxAllocVOSize||0,this.usage=e&&e.usage||ra.USAGE.DYNAMIC;let r=e&&e.voArray;if(r){if(r.usage!==this.usage)throw new Error(`VOPool usage(=${this.usage}) mismatch with given voArray(usage=${r.usage})`)}else r=t.createVOArray(this.capacity,this.usage);this.voArray=r,this.voZero=e&&e.voZero||t.createVO(),this.voNew=e&&e.voNew||t.createVO(),this.availableVOs=[],this.usedVOs=[],ea(this,this.maxAllocVOSize)}get usedCount(){return this.usedVOs.length}get availableCount(){return this.capacity-this.usedVOs.length}get allocatedCount(){return this.availableVOs.length+this.usedVOs.length}alloc(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(t>1){const e=[];for(let r=0;r<t;++r){const t=this.alloc(1);if(void 0===t)break;e.push(t)}return e}const e=this.availableVOs.shift();return void 0===e?this.capacity-this.allocatedCount>0?(ea(this,this.maxAllocVOSize),this.alloc()):void 0:(this.usedVOs.push(e),e.voArray.copy(this.voNew.voArray),e)}free(t){if(Array.isArray(t))return void t.forEach(t=>t.free());const e=this.usedVOs.indexOf(t);if(-1===e)return;const r=this.usedVOs.length-1;if(e!==r){const n=this.usedVOs[r];t.voArray.copy(n.voArray);const a=n.voArray;n.voArray=t.voArray,t.voArray=a,this.usedVOs.splice(e,1,n)}this.usedVOs.pop(),this.availableVOs.unshift(t),t.voArray.copy(this.voZero.voArray)}}ra.USAGE=pt.USAGE;const na=(t,e)=>{if("function"==typeof e){const r=t.createVO();return e(r),r}return e};class aa{constructor(t,e,r){this.resourceLibrary=t,this.textureLibrary=e,this.descriptor=t.findDescriptor(r.descriptor),this.voPool=new ra(this.descriptor,Object.assign($n(r,["capacity","usage","maxAllocVOSize","voArray"]),{voNew:na(this.descriptor,r.voNew),voZero:na(this.descriptor,r.voZero)})),this.voPoolShaderAttribs=new ta(this.voPool),this.indices=r.indices||Xn.Generate(this.voPool.capacity,[0,1,2,0,2,3],4),this.shaderProgram=new Wn(t.findVertexShader(r.vertexShader),t.findFragmentShader(r.fragmentShader)),this.primitive=r.primitive,this.textures=Object.assign({},r.textures),this.shaderTextureGroup=null}get capacity(){return this.voPool.capacity}get usedCount(){return this.voPool.usedCount}get availableCount(){return this.voPool.availableCount}setTexture(t,e){this.textures[t]!==e&&(this.textures[t]=e,this.shaderTextureGroup=null)}loadTextureAtlas(t,e){return this.textures[t]=e,this.shaderTextureGroup=null,this.textureLibrary.loadTextureAtlas(e)}getTextureAtlas(t){return this.textureLibrary.getTextureAtlas(this.textures[t])}createSprite(t,e,r){const n=e||t.width,a=r||t.height,i=this.voPool.alloc(1);return i.setSize(n,a),i.setTexCoordsByTexture(t),i}renderFrame(t){null==this.shaderTextureGroup&&(this.shaderTextureGroup=new Zn(this.textureLibrary,this.textures)),this.shaderTextureGroup.whenLoaded(e=>{const r=t.shaderContext;r.pushVar(e),r.pushVar(this.voPoolShaderAttribs),t.useShaderProgram(this.shaderProgram),t.drawIndexed(this.primitive,this.indices)})}}const ia=t=>"string"==typeof t&&t.length>0,oa=t=>"number"==typeof t&&t>0,sa=t=>{let e=t.descriptor,r=t.capacity;return{descriptor:e,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,primitive:t.primitive,capacity:parseInt(r,10),voNew:t=>{t.scale=1,t.opacity=1}}},la=t=>sa({descriptor:t.getAttribute("descriptor"),vertexShader:t.getAttribute("vertex-shader"),fragmentShader:t.getAttribute("fragment-shader"),primitive:t.getAttribute("primitive"),capacity:t.getAttribute("capacity")}),ua=t=>ia(t.descriptor)&&ia(t.vertexShader)&&ia(t.fragmentShader)&&ia(t.primitive)&&oa(t.capacity),ca=t=>{if(!t.parentScene)return;const e=la(t);ua(e)&&(t.spriteGroup=new aa(t.resourceLibrary,t.textureLibrary,e),t._resolvePromise(t.spriteGroup),delete t._resolvePromise)},ha=(t,e)=>{const r=t.spriteGroup;if(!r)return;const n=te(e);n&&"object"==typeof n&&(t.textureMap={},Object.keys(n).forEach(e=>{const a=n[e],i=t.blitpunkCanvas.querySelector(a);t.textureMap[e]=i.textureId,r.setTexture(e,i.textureId)}))};class fa extends HTMLElement{static get observedAttributes(){return["texture-map","capacity","descriptor","fragment-shader","primitive","vertex-shader"]}constructor(t){const e=super(t);return e.spriteGroupPromise=new Promise(t=>{e._resolvePromise=t}),et(e)}get blitpunkNodeName(){return Ee}renderFrame(t){this.spriteGroup&&this.spriteGroup.renderFrame(t)}debug(){console.log(this.spriteGroup),this.textureMap&&console.log("texture-map",this.textureMap)}connectedCallback(){je(this),this.textureLibrary=this.parentSceneElement.textureLibrary,this.resourceLibrary=this.parentSceneElement.resourceLibrary,ca(this),ha(this,this.getAttribute("texture-map"))}disconnectedCallback(){this.textureMap=null,this.spriteGroup=null,this.textureLibrary=null,this.resourceLibrary=null,qe(this)}attributeChangedCallback(t,e,r){"texture-map"===t?ha(this,this.getAttribute(r)):this.spriteGroup||ca(this)}}var da=function(t,e){function r(){var t=F.splice(0,F.length);for(Xt=0;t.length;)t.shift().call(null,t.shift())}function n(t,e){for(var r=0,n=t.length;r<n;r++)p(t[r],e)}function a(t){for(var e,r=0,n=t.length;r<n;r++)e=t[r],R(e,nt[o(e)])}function i(t){return function(e){Ct(e)&&(p(e,t),at.length&&n(e.querySelectorAll(at),t))}}function o(t){var e=Vt.call(t,"is"),r=t.nodeName.toUpperCase(),n=ot.call(rt,e?J+e.toUpperCase():Q+r);return e&&-1<n&&!s(r,e)?-1:n}function s(t,e){return-1<at.indexOf(t+'[is="'+e+'"]')}function l(t){var e=t.currentTarget,r=t.attrChange,n=t.attrName,a=t.target,i=t[$]||2,o=t[X]||3;!te||a&&a!==e||!e[U]||"style"===n||t.prevValue===t.newValue&&(""!==t.newValue||r!==i&&r!==o)||e[U](n,r===i?null:t.prevValue,r===o?null:t.newValue)}function u(t){var e=i(t);return function(t){F.push(e,t.target),Xt&&clearTimeout(Xt),Xt=setTimeout(r,1)}}function c(t){Jt&&(Jt=!1,t.currentTarget.removeEventListener(Z,c)),at.length&&n((t.target||I).querySelectorAll(at),t.detail===k?k:N),Rt&&d()}function h(t,e){var r=this;qt.call(r,t,e),E.call(r,{target:r})}function f(t,e){_t(t,e),_?_.observe(t,Gt):(Qt&&(t.setAttribute=h,t[C]=T(t),t[z](K,E)),t[z](W,l)),t[Y]&&te&&(t.created=!0,t[Y](),t.created=!1)}function d(){for(var t,e=0,r=zt.length;e<r;e++)t=zt[e],it.contains(t)||(r--,zt.splice(e--,1),p(t,k))}function m(t){throw new Error("A "+t+" type is already registered")}function p(t,e){var r,n=o(t);-1<n&&(O(t,nt[n]),n=0,e!==N||t[N]?e!==k||t[k]||(t[N]=!1,t[k]=!0,n=1):(t[k]=!1,t[N]=!0,n=1,Rt&&ot.call(zt,t)<0&&zt.push(t)),n&&(r=t[e+H])&&r.call(t))}function g(){}function M(t,e,r){var n=r&&r[V]||"",a=e.prototype,i=Tt(a),o=e.observedAttributes||ht,s={prototype:i};Pt(i,Y,{value:function(){if(At)At=!1;else if(!this[bt]){this[bt]=!0,new e(this),a[Y]&&a[Y].call(this);var t=Dt[Et.get(e)];(!vt||t.create.length>1)&&v(this)}}}),Pt(i,U,{value:function(t){-1<ot.call(o,t)&&a[U].apply(this,arguments)}}),a[q]&&Pt(i,j,{value:a[q]}),a[B]&&Pt(i,G,{value:a[B]}),n&&(s[V]=n),t=t.toUpperCase(),Dt[t]={constructor:e,create:n?[n,wt(t)]:[t]},Et.set(e,t),I[P](t.toLowerCase(),s),y(t),Ft[t].r()}function b(t){var e=Dt[t.toUpperCase()];return e&&e.constructor}function x(t){return"string"==typeof t?t:t&&t.is||""}function v(t){for(var e,r=t[U],n=r?t.attributes:ht,a=n.length;a--;)e=n[a],r.call(t,e.name||e.nodeName,null,e.value||e.nodeValue)}function y(t){return(t=t.toUpperCase())in Ft||(Ft[t]={},Ft[t].p=new It(function(e){Ft[t].r=e})),Ft[t].p}function S(){xt&&delete t.customElements,ct(t,"customElements",{configurable:!0,value:new g}),ct(t,"CustomElementRegistry",{configurable:!0,value:g});for(var e=function(e){var r=t[e];if(r){t[e]=function(t){var e,n;return t||(t=this),t[bt]||(At=!0,e=Dt[Et.get(t.constructor)],(t=(n=vt&&1===e.create.length)?Reflect.construct(r,ht,e.constructor):I.createElement.apply(I,e.create))[bt]=!0,At=!1,n||v(t)),t},t[e].prototype=r.prototype;try{r.prototype.constructor=t[e]}catch(n){Mt=!0,ct(r,bt,{value:t[e]})}}},r=D.get(/^HTML[A-Z]*[a-z]/),n=r.length;n--;e(r[n]));I.createElement=function(t,e){var r=x(e);return r?Yt.call(this,t,wt(r)):Yt.call(this,t)},Wt||(Kt=!0,I[P](""))}var I=t.document,A=t.Object,D=function(t){var e,r,n,a,i=/^[A-Z]+[a-z]/,o=function(t){var e,r=[];for(e in l)t.test(e)&&r.push(e);return r},s=function(t,e){(e=e.toLowerCase())in l||(l[t]=(l[t]||[]).concat(e),l[e]=l[e.toUpperCase()]=t)},l=(A.create||A)(null),u={};for(r in t)for(a in t[r])for(n=t[r][a],l[a]=n,e=0;e<n.length;e++)l[n[e].toLowerCase()]=l[n[e].toUpperCase()]=a;return u.get=function(t){return"string"==typeof t?l[t]||(i.test(t)?[]:""):o(t)},u.set=function(t,e){return i.test(t)?s(t,e):s(e,t),u},u}({collections:{HTMLAllCollection:["all"],HTMLCollection:["forms"],HTMLFormControlsCollection:["elements"],HTMLOptionsCollection:["options"]},elements:{Element:["element"],HTMLAnchorElement:["a"],HTMLAppletElement:["applet"],HTMLAreaElement:["area"],HTMLAttachmentElement:["attachment"],HTMLAudioElement:["audio"],HTMLBRElement:["br"],HTMLBaseElement:["base"],HTMLBodyElement:["body"],HTMLButtonElement:["button"],HTMLCanvasElement:["canvas"],HTMLContentElement:["content"],HTMLDListElement:["dl"],HTMLDataElement:["data"],HTMLDataListElement:["datalist"],HTMLDetailsElement:["details"],HTMLDialogElement:["dialog"],HTMLDirectoryElement:["dir"],HTMLDivElement:["div"],HTMLDocument:["document"],HTMLElement:["element","abbr","address","article","aside","b","bdi","bdo","cite","code","command","dd","dfn","dt","em","figcaption","figure","footer","header","i","kbd","mark","nav","noscript","rp","rt","ruby","s","samp","section","small","strong","sub","summary","sup","u","var","wbr"],HTMLEmbedElement:["embed"],HTMLFieldSetElement:["fieldset"],HTMLFontElement:["font"],HTMLFormElement:["form"],HTMLFrameElement:["frame"],HTMLFrameSetElement:["frameset"],HTMLHRElement:["hr"],HTMLHeadElement:["head"],HTMLHeadingElement:["h1","h2","h3","h4","h5","h6"],HTMLHtmlElement:["html"],HTMLIFrameElement:["iframe"],HTMLImageElement:["img"],HTMLInputElement:["input"],HTMLKeygenElement:["keygen"],HTMLLIElement:["li"],HTMLLabelElement:["label"],HTMLLegendElement:["legend"],HTMLLinkElement:["link"],HTMLMapElement:["map"],HTMLMarqueeElement:["marquee"],HTMLMediaElement:["media"],HTMLMenuElement:["menu"],HTMLMenuItemElement:["menuitem"],HTMLMetaElement:["meta"],HTMLMeterElement:["meter"],HTMLModElement:["del","ins"],HTMLOListElement:["ol"],HTMLObjectElement:["object"],HTMLOptGroupElement:["optgroup"],HTMLOptionElement:["option"],HTMLOutputElement:["output"],HTMLParagraphElement:["p"],HTMLParamElement:["param"],HTMLPictureElement:["picture"],HTMLPreElement:["pre"],HTMLProgressElement:["progress"],HTMLQuoteElement:["blockquote","q","quote"],HTMLScriptElement:["script"],HTMLSelectElement:["select"],HTMLShadowElement:["shadow"],HTMLSlotElement:["slot"],HTMLSourceElement:["source"],HTMLSpanElement:["span"],HTMLStyleElement:["style"],HTMLTableCaptionElement:["caption"],HTMLTableCellElement:["td","th"],HTMLTableColElement:["col","colgroup"],HTMLTableElement:["table"],HTMLTableRowElement:["tr"],HTMLTableSectionElement:["thead","tbody","tfoot"],HTMLTemplateElement:["template"],HTMLTextAreaElement:["textarea"],HTMLTimeElement:["time"],HTMLTitleElement:["title"],HTMLTrackElement:["track"],HTMLUListElement:["ul"],HTMLUnknownElement:["unknown","vhgroupv","vkeygen"],HTMLVideoElement:["video"]},nodes:{Attr:["node"],Audio:["audio"],CDATASection:["node"],CharacterData:["node"],Comment:["#comment"],Document:["#document"],DocumentFragment:["#document-fragment"],DocumentType:["node"],HTMLDocument:["#document"],Image:["img"],Option:["option"],ProcessingInstruction:["node"],ShadowRoot:["#shadow-root"],Text:["#text"],XMLDocument:["xml"]}});e||(e="auto");var F,E,w,T,_,L,O,R,P="registerElement",C="__"+P+(1e5*t.Math.random()>>0),z="addEventListener",N="attached",H="Callback",k="detached",V="extends",U="attributeChanged"+H,j=N+H,q="connected"+H,B="disconnected"+H,Y="created"+H,G=k+H,$="ADDITION",X="REMOVAL",W="DOMAttrModified",Z="DOMContentLoaded",K="DOMSubtreeModified",Q="<",J="=",tt=/^[A-Z][A-Z0-9]*(?:-[A-Z0-9]+)+$/,et=["ANNOTATION-XML","COLOR-PROFILE","FONT-FACE","FONT-FACE-SRC","FONT-FACE-URI","FONT-FACE-FORMAT","FONT-FACE-NAME","MISSING-GLYPH"],rt=[],nt=[],at="",it=I.documentElement,ot=rt.indexOf||function(t){for(var e=this.length;e--&&this[e]!==t;);return e},st=A.prototype,lt=st.hasOwnProperty,ut=st.isPrototypeOf,ct=A.defineProperty,ht=[],ft=A.getOwnPropertyDescriptor,dt=A.getOwnPropertyNames,mt=A.getPrototypeOf,pt=A.setPrototypeOf,gt=!!A.__proto__,Mt=!1,bt="__dreCEv1",xt=t.customElements,vt="force"!==e&&!!(xt&&xt.define&&xt.get&&xt.whenDefined),yt=A.create||A,St=t.Map||function(){var t,e=[],r=[];return{get:function(t){return r[ot.call(e,t)]},set:function(n,a){(t=ot.call(e,n))<0?r[e.push(n)-1]=a:r[t]=a}}},It=t.Promise||function(t){function e(t){for(n=!0;r.length;)r.shift()(t)}var r=[],n=!1,a={catch:function(){return a},then:function(t){return r.push(t),n&&setTimeout(e,1),a}};return t(e),a},At=!1,Dt=yt(null),Ft=yt(null),Et=new St,wt=function(t){return t.toLowerCase()},Tt=A.create||function t(e){return e?(t.prototype=e,new t):this},_t=pt||(gt?function(t,e){return t.__proto__=e,t}:dt&&ft?function(){function t(t,e){for(var r,n=dt(e),a=0,i=n.length;a<i;a++)r=n[a],lt.call(t,r)||ct(t,r,ft(e,r))}return function(e,r){do{t(e,r)}while((r=mt(r))&&!ut.call(r,e));return e}}():function(t,e){for(var r in e)t[r]=e[r];return t}),Lt=t.MutationObserver||t.WebKitMutationObserver,Ot=(t.HTMLElement||t.Element||t.Node).prototype,Rt=!ut.call(Ot,it),Pt=Rt?function(t,e,r){return t[e]=r.value,t}:ct,Ct=Rt?function(t){return 1===t.nodeType}:function(t){return ut.call(Ot,t)},zt=Rt&&[],Nt=Ot.attachShadow,Ht=Ot.cloneNode,kt=Ot.dispatchEvent,Vt=Ot.getAttribute,Ut=Ot.hasAttribute,jt=Ot.removeAttribute,qt=Ot.setAttribute,Bt=I.createElement,Yt=Bt,Gt=Lt&&{attributes:!0,characterData:!0,attributeOldValue:!0},$t=Lt||function(t){Qt=!1,it.removeEventListener(W,$t)},Xt=0,Wt=P in I,Zt=!0,Kt=!1,Qt=!0,Jt=!0,te=!0;if(Wt||(pt||gt?(O=function(t,e){ut.call(e,t)||f(t,e)},R=f):R=O=function(t,e){t[C]||(t[C]=A(!0),f(t,e))},Rt?(Qt=!1,function(){var t=ft(Ot,z),e=t.value,r=function(t){var e=new CustomEvent(W,{bubbles:!0});e.attrName=t,e.prevValue=Vt.call(this,t),e.newValue=null,e[X]=e.attrChange=2,jt.call(this,t),kt.call(this,e)},n=function(t,e){var r=Ut.call(this,t),n=r&&Vt.call(this,t),a=new CustomEvent(W,{bubbles:!0});qt.call(this,t,e),a.attrName=t,a.prevValue=r?n:null,a.newValue=e,r?a.MODIFICATION=a.attrChange=1:a[$]=a.attrChange=0,kt.call(this,a)},a=function(t){var e,r=t.currentTarget,n=r[C],a=t.propertyName;n.hasOwnProperty(a)&&(n=n[a],(e=new CustomEvent(W,{bubbles:!0})).attrName=n.name,e.prevValue=n.value||null,e.newValue=n.value=r[a]||null,null==e.prevValue?e[$]=e.attrChange=0:e.MODIFICATION=e.attrChange=1,kt.call(r,e))};t.value=function(t,i,o){t===W&&this[U]&&this.setAttribute!==n&&(this[C]={className:{name:"class",value:this.className}},this.setAttribute=n,this.removeAttribute=r,e.call(this,"propertychange",a)),e.call(this,t,i,o)},ct(Ot,z,t)}()):Lt||(it[z](W,$t),it.setAttribute(C,1),it.removeAttribute(C),Qt&&(E=function(t){var e,r,n,a=this;if(a===t.target){e=a[C],a[C]=r=T(a);for(n in r){if(!(n in e))return w(0,a,n,e[n],r[n],$);if(r[n]!==e[n])return w(1,a,n,e[n],r[n],"MODIFICATION")}for(n in e)if(!(n in r))return w(2,a,n,e[n],r[n],X)}},w=function(t,e,r,n,a,i){var o={attrChange:t,currentTarget:e,attrName:r,prevValue:n,newValue:a};o[i]=t,l(o)},T=function(t){for(var e,r,n={},a=t.attributes,i=0,o=a.length;i<o;i++)"setAttribute"!==(r=(e=a[i]).name)&&(n[r]=e.value);return n})),I[P]=function(t,e){if(r=t.toUpperCase(),Zt&&(Zt=!1,Lt?(_=function(t,e){function r(t,e){for(var r=0,n=t.length;r<n;e(t[r++]));}return new Lt(function(n){for(var a,i,o,s=0,l=n.length;s<l;s++)"childList"===(a=n[s]).type?(r(a.addedNodes,t),r(a.removedNodes,e)):(i=a.target,te&&i[U]&&"style"!==a.attributeName&&(o=Vt.call(i,a.attributeName))!==a.oldValue&&i[U](a.attributeName,a.oldValue,o))})}(i(N),i(k)),(L=function(t){return _.observe(t,{childList:!0,subtree:!0}),t})(I),Nt&&(Ot.attachShadow=function(){return L(Nt.apply(this,arguments))})):(F=[],I[z]("DOMNodeInserted",u(N)),I[z]("DOMNodeRemoved",u(k))),I[z](Z,c),I[z]("readystatechange",c),Ot.cloneNode=function(t){var e=Ht.call(this,!!t),r=o(e);return-1<r&&R(e,nt[r]),t&&at.length&&a(e.querySelectorAll(at)),e}),Kt)return Kt=!1;if(-2<ot.call(rt,J+r)+ot.call(rt,Q+r)&&m(t),!tt.test(r)||-1<ot.call(et,r))throw new Error("The type "+t+" is invalid");var r,s,l=function(){return f?I.createElement(d,r):I.createElement(d)},h=e||st,f=lt.call(h,V),d=f?e[V].toUpperCase():r;return f&&-1<ot.call(rt,Q+d)&&m(d),s=rt.push((f?J:Q)+r)-1,at=at.concat(at.length?",":"",f?d+'[is="'+t.toLowerCase()+'"]':d),l.prototype=nt[s]=lt.call(h,"prototype")?h.prototype:Tt(Ot),at.length&&n(I.querySelectorAll(at),N),l},I.createElement=Yt=function(t,e){var r=x(e),n=r?Bt.call(I,t,wt(r)):Bt.call(I,t),a=""+t,i=ot.call(rt,(r?J:Q)+(r||a).toUpperCase()),o=-1<i;return r&&(n.setAttribute("is",r=r.toLowerCase()),o&&(o=s(a.toUpperCase(),r))),te=!I.createElement.innerHTMLHelper,o&&R(n,nt[i]),n}),g.prototype={constructor:g,define:vt?function(t,e,r){if(r)M(t,e,r);else{var n=t.toUpperCase();Dt[n]={constructor:e,create:[n]},Et.set(e,n),xt.define(t,e)}}:M,get:vt?function(t){return xt.get(t)||b(t)}:b,whenDefined:vt?function(t){return It.race([xt.whenDefined(t),y(t)])}:y},xt&&"force"!==e)try{!function(e,r,n){if(r[V]="a",e.prototype=Tt(HTMLAnchorElement.prototype),e.prototype.constructor=e,t.customElements.define(n,e,r),Vt.call(I.createElement("a",{is:n}),"is")!==n||vt&&Vt.call(new e,"is")!==n)throw r}(function t(){return Reflect.construct(HTMLAnchorElement,[],t)},{},"document-register-element-a")}catch(t){S()}else S();try{Bt.call(I,"a","a")}catch(t){wt=function(t){return{is:t.toLowerCase()}}}};const ma=Symbol.for("BLITPLUNK_CUSTOM_ELEMENTS_DEFINED");window[ma]||(window[ma]=!0,da(window),window.customElements.define(ve,Ne),window.customElements.define(ye,ke),window.customElements.define(Se,Be),window.customElements.define(Ie,fa));return function(){return new ze}});
